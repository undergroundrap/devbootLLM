<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>devbootLLM - AI-Assisted Bootcamp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.48.0/min/vs/editor/editor.main.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Markdown + Syntax Highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
    <style>
        /* Base styles and custom scrollbar */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #131314; /* Main Gemini BG */
            color: #e3e3e3;
            overflow: hidden;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #131314; }
        ::-webkit-scrollbar-thumb { background: #3c4043; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #5f6368; }
        
        /* Theme colors */
        .gemini-bg-main { background-color: #131314; }
        .gemini-bg-secondary { background-color: #1e1f20; }
        .gemini-bg-tertiary { background-color: #282a2c; }
        .gemini-border { border-color: #3c4043; }
        .editor-bg { background-color: #1E1E1E; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .fade-out { animation: fadeOut 0.3s ease-in forwards; }

        @keyframes toastIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes toastOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        .toast-in { animation: toastIn 0.3s ease-out forwards; }
        .toast-out { animation: toastOut 0.3s ease-in forwards; }
        
        /* Custom button styles */
        .btn {
            font-weight: 700;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: none;
            cursor: pointer;
        }
        .btn:hover {
            filter: brightness(1.1);
        }
        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.5); /* Ring effect */
        }
        .btn-primary { background-color: #7c3aed; color: white; }
        .btn-primary:hover { background-color: #8b5cf6; }
        .btn-secondary { background-color: #3c4043; color: #e3e3e3; }
        .btn-secondary:hover { background-color: #5f6368; }
        .btn-danger { background-color: #dc2626; color: white; }
        .btn-danger:hover { background-color: #ef4444; }
        .btn-success { background-color: #059669; color: white; }
        .btn-success:hover { background-color: #10b981; }
        .btn-info { background-color: #0284c7; color: white; }
        .btn-info:hover { background-color: #0ea5e9; }
        .btn-warning { background-color: #d97706; color: white; }
        .btn-warning:hover { background-color: #f59e0b; }
        .btn:disabled {
            background-color: #282a2c;
            color: #6b7280;
            cursor: not-allowed;
            box-shadow: none;
            filter: brightness(1);
        }

        .card-hover {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        .card-hover:hover {
            transform: translateY(-0.25rem);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            background-color: #282a2c;
        }
        
        /* Modal Styling */
        .modal-container.hidden { pointer-events: none; }
        .modal-bg.opacity-0 { opacity: 0; }
        .modal-content.opacity-0 { opacity: 0; transform: scale(0.95) translateY(1rem); }

        /* Code Block Styling */
        .code-block-wrapper {
            position: relative;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }
        .code-block-copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(60, 64, 67, 0.7);
            color: #e3e3e3;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.5;
            z-index: 10;
        }
        .code-block-wrapper:hover .code-block-copy-btn {
            opacity: 1;
            background-color: #5f6368;
        }
        .code-block-copy-btn:hover {
            background-color: #7c3aed;
        }

        /* Markdown styling within chat bubbles */
        .markdown-body {
            color: #e5e7eb; /* gray-200 */
            line-height: 1.6;
        }
        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3,
        .markdown-body h4,
        .markdown-body h5,
        .markdown-body h6 {
            color: #ffffff;
            margin-top: 0.75rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        .markdown-body h1 { font-size: 1.5rem; }
        .markdown-body h2 { font-size: 1.25rem; }
        .markdown-body h3 { font-size: 1.125rem; }
        .markdown-body p { margin: 0.5rem 0; }
        .markdown-body ul,
        .markdown-body ol { margin-left: 1.25rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
        .markdown-body li { margin: 0.25rem 0; }
        .markdown-body a { color: #93c5fd; text-decoration: underline; }
        .markdown-body blockquote {
            border-left: 4px solid #7c3aed;
            padding-left: 0.75rem;
            color: #c7c7c7;
            margin: 0.5rem 0;
        }
        .markdown-body pre {
            background: rgba(0,0,0,0.5);
            padding: 0.75rem;
            border-radius: 0.5rem;
            overflow-x: auto;
        }
        .markdown-body code {
            background: #374151; /* gray-700 */
            color: #c4b5fd; /* violet-300 */
            border-radius: 0.375rem;
            padding: 0 0.25rem;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.85em;
        }
        .markdown-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.5rem 0;
        }
        .markdown-body th,
        .markdown-body td {
            border: 1px solid #3c4043;
            padding: 0.5rem;
        }
        .markdown-body th { background: #1e1f20; }

        /* AI Typing Indicator */
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #9ca3af;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        /* Resizer style */
        #resizer {
            flex-shrink: 0;
            background-color: #3c4043;
            width: 5px;
            cursor: col-resize;
            transition: background-color 0.2s ease;
        }
        #resizer:hover, #resizer.resizing {
            background-color: #7c3aed;
        }

        /* Sidebar Styles */
        #lesson-sidebar {
            transition: width 0.3s ease-in-out;
            width: 280px;
            flex-shrink: 0;
        }
        #lesson-sidebar.hidden {
            width: 0;
        }
        .sidebar-lesson-item.active {
            background-color: #7c3aed;
            color: white;
        }
         .sidebar-lesson-item.active .text-gray-400 {
            color: #d1d5db;
           }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        /* Force dark styling for native select */
        #ai-model, #ai-provider {
            background-color: #282a2c !important; /* gemini-bg-tertiary */
            color: #e5e7eb !important; /* gray-200 */
            border-color: #3c4043 !important; /* gemini-border */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        #ai-model option, #ai-provider option {
            background-color: #1e1f20; /* gemini-bg-secondary */
            color: #e5e7eb;
        }
        /* Hide default arrow in old IE */
        #ai-model::-ms-expand, #ai-provider::-ms-expand { display: none; }
    </style>
</head>
<body class="antialiased">

    <div id="app-container">

        <!-- LANDING PAGE VIEW -->
        <div id="landing-page-view">
            <div class="flex flex-col min-h-screen">
                <header class="gemini-bg-secondary border-b gemini-border shadow-lg z-20 flex-shrink-0">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-between h-16">
                            <div class="flex items-center space-x-3">
                                <i class="fa-solid fa-brain text-3xl text-violet-400"></i>
                                <span class="text-2xl font-bold text-slate-100 tracking-tight">devbootLLM</span>
                            </div>
                            <nav class="hidden md:flex items-center space-x-6">
                                <a href="#courses" class="text-gray-300 hover:text-violet-400 transition-colors">Courses</a>
                                <a href="#" class="text-gray-300 hover:text-violet-400 transition-colors">About</a>
                                <a href="#" class="text-gray-300 hover:text-violet-400 transition-colors">Contact</a>
                            </nav>
                        </div>
                    </div>
                </header>
                <main class="flex-grow">
                    <section class="py-20 sm:py-28">
                        <div class="max-w-4xl mx-auto text-center px-4">
                            <h1 class="text-4xl md:text-6xl font-extrabold text-white tracking-tighter mb-4">
                                The Self-Taught Developer's <span class="text-violet-400">AI Co-Pilot</span>
                            </h1>
                            <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto mb-8">
                                Master programming with a hands-on, AI-assisted bootcamp. Learn at your own pace, with an intelligent assistant to guide you every step of the way.
                            </p>
                            <a href="#courses" id="start-journey-btn" class="btn btn-primary text-lg">
                                <span>Start Your Journey</span>
                                <i class="fa-solid fa-arrow-down"></i>
                            </a>
                        </div>
                    </section>
                    <section id="courses" class="py-16 sm:py-20 gemini-bg-secondary">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="text-center mb-12">
                                <h2 class="text-3xl md:text-4xl font-bold text-white">Available Learning Paths</h2>
                                <p class="text-gray-400 mt-2">Choose a language to begin your self-taught adventure.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                <!-- Java Course Card -->
                                <div class="gemini-bg-tertiary border gemini-border rounded-xl p-8 flex flex-col card-hover">
                                    <div class="flex-shrink-0 mb-6"><i class="fab fa-java text-6xl text-sky-400"></i></div>
                                    <div class="flex-grow">
                                        <h3 class="text-2xl font-bold text-white mb-2">Java Fundamentals</h3>
                                        <p class="text-gray-400 mb-6">Build a solid foundation in Java, one of the world's most popular programming languages. Perfect for beginners.</p>
                                    </div>
                                    <div class="mt-auto">
                                        <button id="start-java-course-btn" class="btn btn-primary w-full">
                                            <span>Start Learning</span>
                                            <i class="fa-solid fa-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- Python Course Card -->
                                <div class="gemini-bg-tertiary border gemini-border rounded-xl p-8 flex flex-col card-hover">
                                     <div class="flex-shrink-0 mb-6"><i class="fab fa-python text-6xl text-green-400"></i></div>
                                    <div class="flex-grow">
                                        <h3 class="text-2xl font-bold text-white mb-2">Python Essentials</h3>
                                        <p class="text-gray-400 mb-6">Discover the simplicity and power of Python. Ideal for data science, web development, and automation.</p>
                                    </div>
                                    <div class="mt-auto"><button class="btn btn-secondary w-full" disabled><span>Coming Soon</span><i class="fa-solid fa-clock"></i></button></div>
                                </div>
                                <!-- More Courses Card -->
                                <div class="border-2 border-dashed gemini-border rounded-xl p-8 flex flex-col items-center justify-center text-center text-gray-500 card-hover">
                                    <i class="fa-solid fa-plus text-4xl mb-4"></i>
                                    <h3 class="text-xl font-bold">More Paths Coming</h3>
                                    <p class="mt-2">We're working hard to bring you more exciting learning journeys!</p>
                                </div>
                            </div>
                        </div>
                    </section>
                </main>
                <footer class="gemini-bg-secondary border-t gemini-border mt-auto">
                    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-400">
                        <p>&copy; 2025 devbootLLM. All rights reserved.</p>
                    </div>
                </footer>
            </div>
        </div>

        <!-- LEARNING PAGE VIEW -->
        <div id="learning-page-view" class="hidden">
            <div id="app" class="flex flex-col h-screen">
                <canvas id="confetti-canvas"></canvas>
                <header class="gemini-bg-secondary border-b gemini-border shadow-lg z-20 flex-shrink-0">
                    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-between h-16">
                            <div class="flex items-center space-x-3">
                                <button id="sidebar-toggle-btn" class="btn btn-secondary !p-2.5" title="Toggle Lesson Sidebar">
                                    <i class="fa-solid fa-bars"></i>
                                </button>
                                <button id="home-link" class="flex items-center space-x-3 group" title="Back to Home">
                                    <i class="fa-solid fa-brain text-3xl text-violet-400 group-hover:text-violet-300 transition-colors"></i>
                                    <span class="text-2xl font-bold text-slate-100 tracking-tight group-hover:text-white transition-colors">devbootLLM</span>
                                </button>
                            </div>
                            <div id="progress-container" class="flex-grow mx-8 lg:mx-16 flex items-center space-x-4">
                                 <span id="progress-label" class="text-sm font-medium text-gray-400 whitespace-nowrap"></span>
                                 <div class="w-full bg-[#3c4043] rounded-full h-2.5">
                                     <div id="progress-bar" class="bg-violet-500 h-2.5 rounded-full transition-all duration-500 ease-out"></div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center space-x-3">
                                    <div id="db-status-light" class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
                                    <span id="db-status-text" class="text-sm font-medium text-gray-300">Connecting...</span>
                                </div>
                                <button id="reset-progress-btn" class="btn btn-secondary !p-2" title="Reset all progress">
                                    <i class="fa-solid fa-gear"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
                <main class="flex-grow flex flex-row overflow-hidden">
                    <!-- Lesson Sidebar -->
                    <aside id="lesson-sidebar" class="gemini-bg-secondary border-r gemini-border flex flex-col overflow-y-auto">
                        <div class="p-4 border-b gemini-border">
                            <h3 class="text-lg font-bold text-white">Java Fundamentals</h3>
                        </div>
                        <nav id="lesson-list" class="flex-grow p-2 space-y-1"></nav>
                    </aside>

                    <!-- Main Content -->
                    <div class="flex-grow flex flex-row overflow-hidden">
                        <!-- Left Panel: Lesson and Editor -->
                        <div id="left-panel" class="w-3/5 flex flex-col border-r gemini-border h-full">
                            <div id="lesson-panel" class="p-6 gemini-bg-secondary border-b gemini-border fade-in flex-shrink-0">
                                <h1 id="lesson-title" class="text-2xl font-bold text-white mb-2 flex items-center"></h1>
                                <p id="lesson-description" class="text-gray-400 mb-5"></p>
                                <div class="flex justify-between items-center">
                                    <button id="prev-lesson-btn" class="btn btn-secondary" title="Go to the previous lesson"><i class="fa-solid fa-arrow-left"></i><span>Previous</span></button>
                                    <div class="flex items-center space-x-4">
                                        <span id="lesson-status" class="text-sm font-semibold text-gray-500"></span>
                                        <button id="view-tutorial-btn" class="btn btn-info" title="View the tutorial for this lesson"><i class="fa-solid fa-book-open"></i><span>View Tutorial</span></button>
                                    </div>
                                    <button id="next-lesson-btn" class="btn btn-primary" title="Go to the next lesson"><span>Next</span><i class="fa-solid fa-arrow-right"></i></button>
                                </div>
                            </div>
                            <div class="flex-grow flex flex-col relative editor-bg">
                                <div id="editor-container" class="flex-grow relative">
                                    <div id="editor-placeholder" class="absolute inset-0 flex items-center justify-center text-gray-500 text-lg">
                                        <i class="fas fa-spinner fa-spin mr-3"></i> Loading Editor...
                                    </div>
                                    <div id="editor" class="absolute inset-0 opacity-0 transition-opacity duration-500"></div>
                                </div>
                                <div class="flex items-center justify-between space-x-4 p-3 gemini-bg-secondary border-t gemini-border flex-shrink-0">
                                    <div class="flex items-center space-x-2">
                                         <button id="search-btn" class="btn btn-secondary !p-2.5" title="Search in code (Ctrl+F)" aria-label="Search code"><i class="fa-solid fa-magnifying-glass"></i></button>
                                         <button id="format-btn" class="btn btn-secondary !p-2.5" title="Format code (Shift+Alt+F)" aria-label="Format code"><i class="fa-solid fa-wand-magic-sparkles"></i></button>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <button id="solve-btn" class="btn btn-warning" title="Show the solution for this lesson"><i class="fa-solid fa-lightbulb"></i><span>Solve Lesson</span></button>
                                        <button id="reset-btn" class="btn btn-secondary" title="Reset the code to its original state"><i class="fa-solid fa-arrow-rotate-left"></i><span>Reset Code</span></button>
                                        <button id="run-btn" class="btn btn-success text-lg py-2.5 px-8" title="Check your code (Ctrl+Enter)"><i class="fa-solid fa-play"></i><span>Check Code</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Resizer -->
                        <div id="resizer"></div>
                        <!-- Right Panel: Console and AI -->
                        <div id="right-panel" class="w-2/5 flex flex-col gemini-bg-main h-full">
                            <div class="h-1/3 flex flex-col border-b gemini-border">
                                <div class="flex items-center justify-between p-4 flex-shrink-0 text-gray-300 border-b gemini-border gemini-bg-tertiary">
                                    <h2 class="text-lg font-semibold flex items-center"><i class="fa-solid fa-terminal w-5 mr-3"></i>Console</h2>
                                    <button id="clear-console-btn" class="text-gray-400 hover:text-white" title="Clear console log"><i class="fa-solid fa-eraser"></i></button>
                                </div>
                                <div id="console-output" class="bg-[#131314] p-4 text-sm font-mono flex-grow overflow-y-auto space-y-1"></div>
                            </div>
                            <div class="h-2/3 flex flex-col">
                                <h2 class="text-lg font-semibold p-4 flex items-center flex-shrink-0 text-gray-300 border-b gemini-border gemini-bg-tertiary"><i class="fa-solid fa-robot w-5 mr-3 text-violet-400"></i>AI Assistant</h2>
                                <div id="ai-chat" class="flex-grow p-4 overflow-y-auto space-y-4"></div>
                                <div class="p-4 border-t gemini-border gemini-bg-main flex-shrink-0">
                                    <div class="flex items-center justify-between mb-2 text-xs text-gray-400">
                                        <div class="flex items-center space-x-3">
                                            <div class="flex items-center space-x-2">
                                                <label for="ai-provider" class="mr-1">Provider:</label>
                                                <div class="relative inline-block">
                                                    <select id="ai-provider" class="appearance-none gemini-bg-tertiary border gemini-border text-gray-200 rounded-md px-3 py-2 pr-8 text-xs focus:outline-none focus:ring-1 focus:ring-violet-500 focus:border-violet-500 transition-colors"></select>
                                                    <i class="fa-solid fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <label for="ai-model" class="mr-1">Model:</label>
                                                <div class="relative inline-block">
                                                    <select id="ai-model" class="appearance-none gemini-bg-tertiary border gemini-border text-gray-200 rounded-md px-3 py-2 pr-8 text-xs focus:outline-none focus:ring-1 focus:ring-violet-500 focus:border-violet-500 transition-colors"></select>
                                                    <i class="fa-solid fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                                </div>
                                                <button id="ai-model-refresh-btn" class="text-gray-400 hover:text-gray-200" title="Refresh models" aria-label="Refresh models">
                                                    <i class="fa-solid fa-rotate"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-start bg-gemini-bg-tertiary rounded-lg border gemini-border focus-within:border-violet-500 transition-colors">
                                        <textarea id="ai-input" class="flex-grow bg-transparent border-none p-3 focus:outline-none focus:ring-0 text-sm text-gray-200 resize-none" placeholder="Ask for a hint or explanation..." rows="1"></textarea>
                                        <button id="ai-ask-btn" class="btn btn-primary m-1.5 py-1.5 px-3 self-end" title="Ask the AI Assistant" aria-label="Ask AI Assistant"><i id="ai-ask-icon" class="fa-solid fa-paper-plane"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                
                <!-- Tutorial Modal -->
                <div id="tutorial-modal" class="modal-container fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
                    <div id="tutorial-modal-bg" class="modal-bg absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity duration-300 opacity-0"></div>
                    <div id="tutorial-modal-content" class="modal-content gemini-bg-tertiary border gemini-border rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform transition-all duration-300 opacity-0 scale-95">
                        <div class="flex items-center justify-between p-4 border-b gemini-border flex-shrink-0">
                            <h2 id="tutorial-title" class="text-xl font-bold text-white flex items-center"></h2>
                            <button id="close-tutorial-btn" class="text-gray-400 hover:text-white text-2xl font-bold leading-none" title="Close Tutorial" aria-label="Close Tutorial">&times;</button>
                        </div>
                        <div id="tutorial-body" class="p-6 overflow-y-auto"></div>
                    </div>
                </div>

                <!-- Confirmation Modal -->
                <div id="confirm-modal" class="modal-container fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
                    <div id="confirm-modal-bg" class="modal-bg absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity duration-300 opacity-0"></div>
                    <div id="confirm-modal-content" class="modal-content gemini-bg-tertiary border gemini-border rounded-xl shadow-2xl w-full max-w-md flex flex-col transform transition-all duration-300 opacity-0 scale-95">
                        <div class="p-6">
                            <h3 id="confirm-modal-title" class="text-lg font-bold text-white mb-2">Are you sure?</h3>
                            <p id="confirm-modal-text" class="text-gray-300 mb-6">This action cannot be undone.</p>
                        </div>
                        <div class="flex justify-end space-x-3 p-4 bg-gemini-bg-secondary/50 rounded-b-xl">
                            <button id="confirm-modal-cancel-btn" class="btn btn-secondary">Cancel</button>
                            <button id="confirm-modal-confirm-btn" class="btn btn-danger">Confirm</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-[100] space-y-3"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.48.0/min/vs/loader.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules - REMOVED

        document.addEventListener('DOMContentLoaded', () => {

            // --- LocalStorage Service: Handles all local storage interactions ---
            class LocalStorageService {
                constructor(appController) {
                    this.appController = appController;
                    this.storageKey = 'devbootllm-java-progress';
                }

                init() {
                    // Simulate async initialization and load data
                    this.appController.setDbStatus('syncing', 'Loading...');
                    setTimeout(() => {
                        this.loadData();
                    }, 100); // Small delay to allow UI to render
                }

                loadData() {
                    try {
                        const savedState = localStorage.getItem(this.storageKey);
                        const state = savedState ? JSON.parse(savedState) : null;
                        this.appController.isDbReady = true;
                        this.appController.loadStateFromDb(state);
                        this.appController.setDbStatus('connected', 'Ready');
                    } catch (error) {
                        console.error("Failed to load state from localStorage:", error);
                        this.appController.isDbReady = true;
                        this.appController.loadStateFromDb(null); // Load default state on error
                        this.appController.setDbStatus('error', 'Load Failed');
                    }
                }

                saveData(state) {
                    try {
                        this.appController.setDbStatus('syncing', 'Saving...');
                        localStorage.setItem(this.storageKey, JSON.stringify(state));
                        // Add a small delay to show the "Saving..." status
                        setTimeout(() => {
                             if (this.appController.elements.dbStatusText.textContent === 'Saving...'){
                                this.appController.setDbStatus('connected', 'Saved');
                            }
                        }, 1000);
                    } catch (error) {
                        console.error("Failed to save state to localStorage:", error);
                        this.appController.showToast('Save failed!', 'error');
                        this.appController.setDbStatus('error', 'Save Failed');
                    }
                }

                resetProgress() {
                    try {
                        localStorage.removeItem(this.storageKey);
                        this.appController.showToast('Progress reset successfully!', 'success');
                        // Instead of a full reload, just re-initialize the state
                        this.appController.loadStateFromDb(null);
                    } catch (error) {
                        console.error("Error resetting progress:", error);
                        this.appController.showToast('Reset failed!', 'error');
                    }
                }
            }


            // --- Main Application Controller ---
            class LearningAppController {
                constructor() {
                    this.editor = null;
                    this.storageService = null;
                    this.chatHistory = [];
                    this.currentLessonIndex = 0;
                    this.userCode = {};
                    this.lessonCompletion = {};
                    this.elements = {};
                    this.saveTimeout = null;
                    this.isDbReady = false;
                    this.confettiParticles = [];
                    this.lessons = [
                        // --- LESSONS 1-50 (Content Unchanged) --- //
                        {
                            id: 1,
                            title: '1. Hello, World!',
                            description: 'The classic first step in programming. Your goal is to print the exact text "Hello, World!" to the console. Use `System.out.println()` to achieve this.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Your code here. Print "Hello, World!"\n        \n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Your code here. Print "Hello, World!"\n        System.out.println("Hello, World!");\n    }\n}`,
                            expectedOutput: 'Hello, World!',
                            tutorial: `<p class="mb-4 text-gray-300">In Java, the console is a text output window. To print text to it, we use a built-in command from the System library.</p><p class="mb-4 text-gray-300">The command is <code>System.out.println()</code>. The <code>ln</code> part means "line," so it prints the text and then moves to the next line.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// This line will print "Welcome to Java!" to the console.\nSystem.out.println("Welcome to Java!");\n\n// This will print a number. Numbers don't need quotes.\nSystem.out.println(123);</pre></div><p class="mt-4 text-gray-300">For this lesson, you need to print the specific phrase "Hello, World!".</p>`
                        },
                        {
                            id: 2,
                            title: '2. Variables & Data Types',
                            description: 'Variables are containers for storing data. Declare an integer variable named `myNumber`, assign it the value `42`, and then print the variable to the console.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Declare an integer variable named myNumber with value 42\n        \n\n        // Print the myNumber variable\n        \n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Declare an integer variable named myNumber with value 42\n        int myNumber = 42;\n\n        // Print the myNumber variable\n        System.out.println(myNumber);\n    }\n}`,
                            expectedOutput: '42',
                            tutorial: `<p class="mb-4 text-gray-300">In Java, a variable is like a labeled box where you can store information. You must first <strong>declare</strong> it by giving it a data type and a name.</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>int</code>: for whole numbers (e.g., 5, -10, 42).</li><li><code>String</code>: for text (e.g., "Hello, World!").</li><li><code>double</code>: for decimal numbers (e.g., 3.14).</li><li><code>boolean</code>: for true or false values.</li></ul><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// 1. Declare a variable 'age' of type 'int'\nint age;\n\n// 2. Assign the value 25 to it\nage = 25;\n\n// You can also declare and assign in one line (which is common):\nint score = 100;\n\n// 3. Print the value stored in the variable (notice no quotes)\nSystem.out.println(score); // This will print 100</pre></div><p class="mt-4 text-gray-300">In this lesson, create an <code>int</code> variable named <code>myNumber</code>, give it the value <code>42</code>, and print it.</p>`
                        },
                        {
                            id: 3,
                            title: '3. While Loops',
                            description: 'A `while` loop executes a block of code as long as a specified condition is true. Create a loop that prints numbers from 1 to 5, each on a new line.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int i = 1;\n\n        // Create a while loop that runs as long as i is less than or equal to 5\n        // Inside the loop, print the value of i and then increment it.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int i = 1;\n\n        // Create a while loop that runs as long as i is less than or equal to 5\n        // Inside the loop, print the value of i and then increment it.\n        while (i <= 5) {\n            System.out.println(i);\n            i++;\n        }\n    }\n}`,
                            expectedOutput: '1\n2\n3\n4\n5',
                            tutorial: `<p class="mb-4 text-gray-300">A <code>while</code> loop is used to repeat a block of code as long as a condition is met. It's useful when you don't know exactly how many times you need to loop.</p><p class="mb-4 text-gray-300"><strong>Crucially</strong>, you must ensure the condition eventually becomes false, otherwise you'll create an infinite loop!</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int countdown = 3;\n\nwhile (countdown > 0) {\n    System.out.println(countdown);\n    countdown--; // This is essential to avoid an infinite loop!\n}\n\nSystem.out.println("Blast off!");</pre></div><p class="mt-4 text-gray-300">For this lesson, initialize a counter and use a <code>while</code> loop to print numbers 1 through 5. Don't forget to increment your counter inside the loop!</p>`
                        },
                        {
                            id: 4,
                            title: '4. For Loops',
                            description: 'A `for` loop is ideal when you know exactly how many times you want to loop. Use a for loop to print the numbers from 0 to 4, each on a new line.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Create a for loop that initializes a counter at 0,\n        // continues as long as it's less than 5, and increments by 1.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Create a for loop that initializes a counter at 0,\n        // continues as long as it's less than 5, and increments by 1.\n        for (int i = 0; i < 5; i++) {\n            System.out.println(i);\n        }\n    }\n}`,
                            expectedOutput: '0\n1\n2\n3\n4',
                            tutorial: `<p class="mb-4 text-gray-300">A <strong>for loop</strong> provides a concise way to write a loop structure. It consists of three parts, separated by semicolons:</p><ol class="list-decimal list-inside mb-4 text-gray-300 space-y-2"><li><strong>Initialization:</strong> Executed once at the beginning (e.g., <code>int i = 0</code>).</li><li><strong>Condition:</strong> Evaluated before each loop iteration. If it's false, the loop stops (e.g., <code>i < 5</code>).</li><li><strong>Increment/Decrement:</strong> Executed at the end of each iteration (e.g., <code>i++</code>).</li></ol><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// This loop will print "Iteration 0" through "Iteration 4"\nfor (int i = 0; i < 5; i++) {\n    System.out.println("Iteration " + i);\n}</pre></div><p class="mt-4 text-gray-300">Your task is to create a for loop that prints the value of the counter <code>i</code> on each iteration, from 0 up to (but not including) 5.</p>`
                        },
                        {
                            id: 5,
                            title: '5. Introduction to Arrays',
                            description: 'An array is a collection of similar types of data. Create an array of integers, store some numbers in it, and then print the second element from the array.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Declare and initialize an integer array named 'numbers'\n        // with the values 10, 20, 30, 40, 50.\n\n        // Print the element at index 1 of the array.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Declare and initialize an integer array named 'numbers'\n        // with the values 10, 20, 30, 40, 50.\n        int[] numbers = {10, 20, 30, 40, 50};\n\n        // Print the element at index 1 of the array.\n        System.out.println(numbers[1]);\n    }\n}`,
                            expectedOutput: '20',
                            tutorial: `<p class="mb-4 text-gray-300">An <strong>array</strong> is a container object that holds a fixed number of values of a single type. The length of an array is established when the array is created.</p><p class="mb-4 text-gray-300">Array elements are accessed by their <strong>index</strong>, which starts at <strong>0</strong>. So, the first element is at index 0, the second at index 1, and so on.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// Declare and initialize an array of Strings\nString[] fruits = {"Apple", "Banana", "Cherry"};\n\n// Access and print the first element (index 0)\nSystem.out.println(fruits[0]); // Prints "Apple"\n\n// Access and print the third element (index 2)\nSystem.out.println(fruits[2]); // Prints "Cherry"</pre></div><p class="mt-4 text-gray-300">Your task is to create an integer array and print the element at index 1, which is the second value in the list.</p>`
                        },
                        {
                            id: 6,
                            title: '6. Intro to Classes & Objects',
                            description: 'Java is an Object-Oriented language. A `class` is a blueprint for creating `objects`. Create a simple `Dog` class with a `bark()` method, then create an object of that class and call its method.',
                            initialCode: `// First, define the Dog class outside of the Main class\nclass Dog {\n    // Add a public void method named bark() that prints "Woof!"\n\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create an instance (an object) of the Dog class\n\n        // Call the bark() method on your new dog object\n\n    }\n}`,
                            fullSolution: `// First, define the Dog class outside of the Main class\nclass Dog {\n    // Add a public void method named bark() that prints "Woof!"\n    public void bark() {\n        System.out.println("Woof!");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create an instance (an object) of the Dog class\n        Dog myDog = new Dog();\n\n        // Call the bark() method on your new dog object\n        myDog.bark();\n    }\n}`,
                            expectedOutput: 'Woof!',
                            tutorial: `<p class="mb-4 text-gray-300">A <strong>class</strong> is a template for creating objects. It defines an object's properties (fields) and behaviors (methods).</p><p class="mb-4 text-gray-300">An <strong>object</strong> is an instance of a class. You can create many objects from a single class blueprint.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// The blueprint for a Car\nclass Car {\n    // A behavior (method) of the Car\n    public void startEngine() {\n        System.out.println("Engine started!");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create an object (an instance) from the Car class\n        Car myCar = new Car();\n        \n        // Call a method on the object\n        myCar.startEngine(); // Prints "Engine started!"\n    }\n}</pre></div>`
                        },
                        {
                            id: 7,
                            title: '7. Advanced Conditionals (Else If)',
                            description: "Check multiple conditions using `if`, `else if`, and `else`. Based on the `score` variable, print 'Excellent' for scores > 90, 'Good' for scores > 75, and 'Needs Improvement' for all others.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int score = 85;\n\n        // Your if-else if-else statement here\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int score = 85;\n\n        // Your if-else if-else statement here\n        if (score > 90) {\n            System.out.println("Excellent");\n        } else if (score > 75) {\n            System.out.println("Good");\n        } else {\n            System.out.println("Needs Improvement");\n        }\n    }\n}`,
                            expectedOutput: 'Good',
                            tutorial: `<p class="mb-4 text-gray-300">The <strong>if-else if-else</strong> statement is perfect for when you have multiple conditions to check in sequence. Java checks them from top to bottom and runs the code for the first one that is true.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int number = 0;\n\nif (number > 0) {\n    System.out.println("The number is positive.");\n} else if (number < 0) {\n    System.out.println("The number is negative.");\n} else {\n    System.out.println("The number is zero.");\n}</pre></div><p class="mt-4 text-gray-300">Notice how only one of the blocks can ever run. The final <code>else</code> is a catch-all if none of the previous conditions were met.</p>`
                        },
                        {
                            id: 8,
                            title: '8. Logical Operators',
                            description: "Combine conditions using logical operators. Use the `&&` (AND) operator to check if a user is both `loggedIn` and an `isAdmin`. To pass, change `isAdmin` to `true` and print 'Admin Access Granted'.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        boolean loggedIn = true;\n        boolean isAdmin = false;\n\n        // Change isAdmin to true on this line\n\n        // Use an if statement with the && operator to check both variables\n        // If the condition is true, print "Admin Access Granted"\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        boolean loggedIn = true;\n        boolean isAdmin = false;\n\n        // Change isAdmin to true on this line\n        isAdmin = true;\n\n        // Use an if statement with the && operator to check both variables\n        // If the condition is true, print "Admin Access Granted"\n        if (loggedIn && isAdmin) {\n            System.out.println("Admin Access Granted");\n        }\n    }\n}`,
                            expectedOutput: 'Admin Access Granted',
                            tutorial: `<p class="mb-4 text-gray-300">Logical operators let you create more complex conditions:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li><code>&&</code> (AND): True only if <strong>both</strong> conditions are true.</li><li><code>||</code> (OR): True if <strong>at least one</strong> condition is true.</li><li><code>!</code> (NOT): Inverts the boolean value (true becomes false, false becomes true).</li></ul><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int age = 25;\nboolean hasLicense = true;\n\nif (age >= 18 && hasLicense) {\n    System.out.println("You are eligible to drive.");\n}</pre></div><p class="mt-4 text-gray-300">For this lesson, you'll need to write an <code>if</code> statement that checks if both <code>loggedIn</code> and <code>isAdmin</code> are true. To make the condition pass, you will also need to change the value of <code>isAdmin</code> from <code>false</code> to <code>true</code>.</p>`
                        },
                        {
                            id: 9,
                            title: '9. Creating Methods',
                            description: "Write a reusable block of code called a method. Create a method named `greetUser` that takes a `String` name as a parameter and prints 'Hello, [name]!'. Call this method from `main` with your own name.",
                            initialCode: `public class Main {\n\n    // Define your greetUser method here. It should be public and static.\n\n\n    public static void main(String[] args) {\n        // Call your greetUser method with your name (e.g., "Alex")\n\n    }\n}`,
                            fullSolution: `public class Main {\n\n    // Define your greetUser method here. It should be public and static.\n    public static void greetUser(String name) {\n        System.out.println("Hello, " + name + "!");\n    }\n\n    public static void main(String[] args) {\n        // Call your greetUser method with your name (e.g., "Alex")\n        greetUser("Alex");\n    }\n}`,
                            expectedOutput: null, // Dynamic check
                            tutorial: `<p class="mb-4 text-gray-300">Methods (also called functions in other languages) help you organize code and avoid repetition. You define it once and can call it many times.</p><p class="mb-4 text-gray-300">A method signature has a few parts: visibility (<code>public</code>), other modifiers (<code>static</code>), return type (<code>void</code> if it returns nothing), the method name, and parameters in parentheses.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">public class Main {\n\n    // A method that takes two integers and prints their sum\n    public static void add(int a, int b) {\n        System.out.println(a + b);\n    }\n\n    public static void main(String[] args) {\n        // Call the add method with different arguments\n        add(5, 3);   // Prints 8\n        add(10, 20); // Prints 30\n    }\n}</pre></div>`
                        },
                        {
                            id: 10,
                            title: '10. Methods with Return Values',
                            description: "Methods can compute and return a value. Create a method `add` that takes two integers, returns their sum, and then print the returned result from the `main` method.",
                            initialCode: `public class Main {\n\n    // Create a public static method named 'add' that takes two ints (a, b)\n    // and returns an int which is their sum.\n\n\n    public static void main(String[] args) {\n        // Call the add method with 15 and 27, store the result in a variable,\n        // and then print that result variable.\n\n    }\n}`,
                            fullSolution: `public class Main {\n\n    // Create a public static method named 'add' that takes two ints (a, b)\n    // and returns an int which is their sum.\n    public static int add(int a, int b) {\n        return a + b;\n    }\n\n    public static void main(String[] args) {\n        // Call the add method with 15 and 27, store the result in a variable,\n        // and then print that result variable.\n        int result = add(15, 27);\n        System.out.println(result);\n    }\n}`,
                            expectedOutput: '42',
                            tutorial: `<p class="mb-4 text-gray-300">So far, our methods have used <code>void</code>, meaning they don't return any information. By changing <code>void</code> to a data type (like <code>int</code> or <code>String</code>), we can make the method send a value back to where it was called.</p><p class="mb-4 text-gray-300">The <code>return</code> keyword is used to specify what value to send back. When <code>return</code> is executed, the method stops immediately.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">public class Main {\n\n    // This method takes a number and returns that number doubled.\n    public static int doubleValue(int number) {\n        return number * 2;\n    }\n\n    public static void main(String[] args) {\n        // We call the method and store its return value in a variable.\n        int answer = doubleValue(5);\n\n        // Now we can use the result.\n        System.out.println(answer); // Prints 10\n    }\n}</pre></div><p class="mt-4 text-gray-300">Your task is to create an <code>add</code> method that returns the sum of two numbers.</p>`
                        },
                        {
                            id: 11,
                            title: '11. Looping Through Arrays',
                            description: "Combine loops and arrays to process each item in a collection. Use a `for` loop to iterate through an array of strings and print each name on a new line.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        String[] names = {"Alice", "Bob", "Charlie"};\n\n        // Use a for loop to print each name from the array.\n        // You can get the array's size with 'names.length'.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        String[] names = {"Alice", "Bob", "Charlie"};\n\n        // Use a for loop to print each name from the array.\n        // You can get the array's size with 'names.length'.\n        for (int i = 0; i < names.length; i++) {\n            System.out.println(names[i]);\n        }\n    }\n}`,
                            expectedOutput: 'Alice\nBob\nCharlie',
                            tutorial: `<p class="mb-4 text-gray-300">A very common task is to perform an action on every item in an array. A <code>for</code> loop is perfect for this.</p><p class="mb-4 text-gray-300">You can get the number of items in an array using the <code>.length</code> property. This is extremely useful for setting the loop's condition, ensuring it runs exactly the right number of times.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int[] scores = {98, 87, 100, 91};\n\n// The loop runs as long as 'i' is less than the array's length.\nfor (int i = 0; i < scores.length; i++) {\n    // We use the loop variable 'i' as the index to get each element.\n    System.out.println("Score " + i + ": " + scores[i]);\n}</pre></div><p class="mt-4 text-gray-300">Your goal is to loop through the <code>names</code> array and print each element using <code>System.out.println()</code>.</p>`
                        },
                        {
                            id: 12,
                            title: '12. String Concatenation',
                            description: "Combine strings using the `+` operator. Create two string variables and combine them with a space in between to form a sentence, then print the result.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        String part1 = "Java is";\n        String part2 = "powerful";\n\n        // Create a new string named 'fullSentence' by combining part1, a space, and part2.\n\n\n        // Print the fullSentence.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        String part1 = "Java is";\n        String part2 = "powerful";\n\n        // Create a new string named 'fullSentence' by combining part1, a space, and part2.\n        String fullSentence = part1 + " " + part2;\n\n        // Print the fullSentence.\n        System.out.println(fullSentence);\n    }\n}`,
                            expectedOutput: 'Java is powerful',
                            tutorial: `<p class="mb-4 text-gray-300">In Java, the <code>+</code> operator does double duty. When used with numbers, it performs addition. When used with strings, it performs <strong>concatenation</strong>, which means it joins them together.</p><p class="mb-4 text-gray-300">You can combine variables and string literals (text in quotes) to build up complex strings.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">String user = "Alex";\nint level = 5;\n\n// We can combine strings and other data types.\n// Java automatically converts the number 'level' to a string.\nString message = "Welcome, " + user + "! You are on level " + level + ".";\n\nSystem.out.println(message); // Prints "Welcome, Alex! You are on level 5."</pre></div><p class="mt-4 text-gray-300">For this lesson, combine the two provided strings. Don't forget to add a space <code>" "</code> in between them!</p>`
                        },
                        {
                            id: 13,
                            title: '13. Constructors',
                            description: 'A constructor is a special method that is called when an object is created. Add a constructor to the `Car` class that accepts a `String` for the car\'s color and prints a message.',
                            initialCode: `class Car {\n    String color;\n\n    // Create a constructor for the Car class.\n    // It should accept one String parameter named 'carColor'.\n    // Inside, it should set the instance variable 'color' and\n    // print "A new [color] car has been created."\n\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new Car object with the color "blue".\n        Car myCar = new Car("blue");\n    }\n}`,
                            fullSolution: `class Car {\n    String color;\n\n    // Create a constructor for the Car class.\n    // It should accept one String parameter named 'carColor'.\n    // Inside, it should set the instance variable 'color' and\n    // print "A new [color] car has been created."\n    public Car(String carColor) {\n        this.color = carColor;\n        System.out.println("A new " + this.color + " car has been created.");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new Car object with the color "blue".\n        Car myCar = new Car("blue");\n    }\n}`,
                            expectedOutput: 'A new blue car has been created.',
                            tutorial: `<p class="mb-4 text-gray-300">A <strong>constructor</strong> in Java is a special method used to initialize objects. It is called at the time of object creation. It must have the same name as the class and does not have a return type.</p><p class="mb-4 text-gray-300">Constructors are great for setting up the initial state of an object.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">class Dog {\n    String name;\n\n    // This is the constructor for the Dog class.\n    public Dog(String dogName) {\n        // 'this.name' refers to the instance variable.\n        // 'dogName' refers to the parameter.\n        this.name = dogName;\n        System.out.println("Dog created with name: " + this.name);\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // The constructor is called when we use 'new'.\n        Dog myDog = new Dog("Fido"); // Prints "Dog created with name: Fido"\n    }\n}</pre></div>`
                        },
                        {
                            id: 14,
                            title: '14. Enhanced For Loop',
                            description: 'Java provides a simpler `for-each` loop to iterate over arrays or collections. Use an enhanced for loop to print each fruit from the `fruits` array.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        String[] fruits = {"Apple", "Orange", "Banana"};\n\n        // Use an enhanced for loop (for-each) to print each fruit.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        String[] fruits = {"Apple", "Orange", "Banana"};\n\n        // Use an enhanced for loop (for-each) to print each fruit.\n        for (String fruit : fruits) {\n            System.out.println(fruit);\n        }\n    }\n}`,
                            expectedOutput: 'Apple\nOrange\nBanana',
                            tutorial: `<p class="mb-4 text-gray-300">The <strong>enhanced for loop</strong> (or for-each loop) is a more readable and concise way to iterate through all the elements of an array or collection, without needing an index variable (like <code>i</code>).</p><p class="mb-4 text-gray-300">The syntax is <code>for (Type variableName : arrayName)</code>. In each iteration, the loop automatically assigns the next element from the array to your variable.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int[] numbers = {10, 20, 30};\n\n// For each 'number' of type 'int' in the 'numbers' array...\nfor (int number : numbers) {\n    // ...print it out.\n    System.out.println(number);\n}</pre></div><p class="mt-4 text-gray-300">This is often preferred over a standard for loop when you just need to access each element in order and don't need the index.</p>`
                        },
                        {
                            id: 15,
                            title: '15. User Input (Scanner)',
                            description: 'Real programs need to interact with users. Use the `Scanner` class to get input. The simulation will provide the input "World". Your task is to read it and print "Hello, World".',
                            initialCode: `// We need to import the Scanner class to use it.\nimport java.util.Scanner;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new Scanner object to read from the console.\n        Scanner scanner = new Scanner(System.in);\n\n        System.out.println("Enter a word:");\n\n        // Read the next line of input and store it in a variable.\n        String input = scanner.nextLine();\n\n        // Print "Hello, " followed by the input you received.\n\n    }\n}`,
                            fullSolution: `// We need to import the Scanner class to use it.\nimport java.util.Scanner;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new Scanner object to read from the console.\n        Scanner scanner = new Scanner(System.in);\n\n        System.out.println("Enter a word:");\n\n        // Read the next line of input and store it in a variable.\n        String input = scanner.nextLine();\n\n        // Print "Hello, " followed by the input you received.\n        System.out.println("Hello, " + input);\n    }\n}`,
                            userInput: ["World"], // Simulated input for the engine
                            expectedOutput: 'Enter a word:\nHello, World',
                            tutorial: `<p class="mb-4 text-gray-300">To get input from a user in the console, Java provides the <code>Scanner</code> class. It's part of Java's utility library, so you must first import it at the top of your file with <code>import java.util.Scanner;</code>.</p><p class="mb-4 text-gray-300">You then create a <code>Scanner</code> object, telling it to read from the standard input stream, <code>System.in</code>.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">import java.util.Scanner;\n\npublic class Main {\n    public static void main(String[] args) {\n        Scanner myScanner = new Scanner(System.in);\n        System.out.println("What is your name?");\n\n        // The program will pause here and wait for the user to type.\n        String name = myScanner.nextLine(); \n\n        System.out.println("Nice to meet you, " + name);\n    }\n}</pre></div><p class="mt-4 text-gray-300">For this lesson, the simulator will automatically type "World" for you. Your job is to read that input using <code>scanner.nextLine()</code> and use it to construct the final output.</p>`
                        },
                        {
                            id: 16,
                            title: '16. Switch Statement',
                            description: "Use a `switch` statement to handle different cases for a character variable. Based on the `grade`, set the `comment` variable to the correct string.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        char grade = 'B';\n        String comment = ""; // Initialize the variable\n\n        // Use a switch statement to set the 'comment' variable.\n        // case 'A': "Excellent!"\n        // case 'B': "Good job!"\n        // case 'C': "You passed."\n        // default: "Invalid grade."\n        // Don't forget the 'break' statements!\n\n\n        System.out.println("Comment: " + comment);\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        char grade = 'B';\n        String comment; // It's better to not initialize here\n\n        // Use a switch statement to set the 'comment' variable.\n        // case 'A': "Excellent!"\n        // case 'B': "Good job!"\n        // case 'C': "You passed."\n        // default: "Invalid grade."\n        // Don't forget the 'break' statements!\n        switch (grade) {\n            case 'A':\n                comment = "Excellent!";\n                break;\n            case 'B':\n                comment = "Good job!";\n                break;\n            case 'C':\n                comment = "You passed.";\n                break;\n            default:\n                comment = "Invalid grade.";\n                break;\n        }\n\n        System.out.println("Comment: " + comment);\n    }\n}`,
                            expectedOutput: 'Comment: Good job!',
                            tutorial: `<p class="mb-4 text-gray-300">The <strong>switch</strong> statement is a cleaner alternative to a long chain of <code>if-else if-else</code> statements when you need to compare one variable against several possible constant values.</p><p class="mb-4 text-gray-300">The <code>break</code> keyword is crucial. If you forget it, the code will "fall through" and execute the code in the next <code>case</code> as well, which is usually not what you want.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int day = 4;\nString dayString;\n\nswitch (day) {\n    case 1:  dayString = "Monday";\n             break;\n    case 2:  dayString = "Tuesday";\n             break;\n    case 3:  dayString = "Wednesday";\n             break;\n    // ... and so on\n    default: dayString = "Invalid day";\n             break;\n}\nSystem.out.println(dayString); // Prints "Wednesday" if day was 3</pre></div><p class="mt-4 text-gray-300">Your task is to build a switch statement for the character variable <code>grade</code>. Note that you need to declare the <code>comment</code> variable before the switch, but you will assign its value inside the different cases.</p>`
                        },
                        {
                            id: 17,
                            title: '17. Modifying Array Elements',
                            description: "Arrays are mutable, meaning you can change their contents. Access an element by its index and assign a new value to it.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        String[] heroes = {"Iron Man", "Thor", "Captain America"};\n\n        // The Avengers have a new leader.\n        // Change the element at index 0 to "Black Panther".\n\n\n        // Print the first element of the array to confirm the change.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        String[] heroes = {"Iron Man", "Thor", "Captain America"};\n\n        // The Avengers have a new leader.\n        // Change the element at index 0 to "Black Panther".\n        heroes[0] = "Black Panther";\n\n        // Print the first element of the array to confirm the change.\n        System.out.println(heroes[0]);\n    }\n}`,
                            expectedOutput: 'Black Panther',
                            tutorial: `<p class="mb-4 text-gray-300">Because arrays are mutable (changeable), you can easily update their values. You use the same index syntax you used to read a value, but now you use it on the left side of an assignment operator (<code>=</code>).</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int[] numbers = {1, 2, 99};\n\n// Print the original third element\nSystem.out.println(numbers[2]); // Prints 99\n\n// Change the value at index 2\nnumbers[2] = 3;\n\n// Print the new third element\nSystem.out.println(numbers[2]); // Prints 3</pre></div><p class="mt-4 text-gray-300">Your task is to change the first element of the <code>heroes</code> array to "Black Panther" and then print that first element to the console.</p>`
                        },
                        {
                            id: 18,
                            title: '18. Sum of Array Elements',
                            description: "A common task is to iterate through an array to calculate a value. Use a for-each loop to calculate the sum of all numbers in an array.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {10, 20, 30, 40};\n        int sum = 0;\n\n        // Use a for-each loop to iterate through the 'numbers' array.\n        // In each iteration, add the current number to the 'sum' variable.\n\n\n        // After the loop, print the final sum.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {10, 20, 30, 40};\n        int sum = 0;\n\n        // Use a for-each loop to iterate through the 'numbers' array.\n        // In each iteration, add the current number to the 'sum' variable.\n        for (int number : numbers) {\n            sum = sum + number;\n        }\n\n        // After the loop, print the final sum.\n        System.out.println(sum);\n    }\n}`,
                            expectedOutput: '100',
                            tutorial: `<p class="mb-4 text-gray-300">This lesson combines several concepts: arrays, loops, and variable modification. The goal is to create an "accumulator" variable (<code>sum</code>) that starts at 0. Then, you loop through each element of the array and add its value to your accumulator.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int[] scores = {5, 10, 15};\nint total = 0;\n\nfor (int score : scores) {\n    total += score; // This is a shorthand for total = total + score;\n}\n\nSystem.out.println("The total is: " + total); // Prints "The total is: 30"</pre></div><p class="mt-4 text-gray-300">Your task is to do the same for the <code>numbers</code> array and print out the final calculated sum.</p>`
                        },
                        {
                            id: 19,
                            title: '19. Finding the Maximum Value',
                            description: "Iterate through an array to find the largest value. This is a classic algorithm that combines loops and conditional logic.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {1, 44, 7, 99, 23, 42};\n        int max = numbers[0]; // Assume the first element is the largest to start.\n\n        // Loop through the array starting from the SECOND element (index 1).\n        // If the current number is greater than 'max', update 'max'.\n\n\n        // After the loop, print the maximum value.\n        System.out.println("The maximum value is: " + max);\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {1, 44, 7, 99, 23, 42};\n        int max = numbers[0]; // Assume the first element is the largest to start.\n\n        // Loop through the array starting from the SECOND element (index 1).\n        // If the current number is greater than 'max', update 'max'.\n        for (int i = 1; i < numbers.length; i++) {\n            if (numbers[i] > max) {\n                max = numbers[i];\n            }\n        }\n\n        // After the loop, print the maximum value.\n        System.out.println("The maximum value is: " + max);\n    }\n}`,
                            expectedOutput: 'The maximum value is: 99',
                            tutorial: `<p class="mb-4 text-gray-300">To find the maximum value in an array, you need a variable to keep track of the largest number found so far. A good strategy is to initialize this variable with the very first value from the array.</p><p class="mb-4 text-gray-300">Then, you loop through the rest of the array. For each number, you compare it to your "max so far" variable. If the current number is larger, you update your max variable with the current number's value. By the end of the loop, your variable will hold the largest value in the entire array.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int[] temps = {72, 85, 68, 91, 78};\nint highestTemp = temps[0]; // Start with 72\n\nfor (int temp : temps) {\n    if (temp > highestTemp) {\n        highestTemp = temp; // Update if we find a warmer day\n    }\n}\n\nSystem.out.println(highestTemp); // Prints 91</pre></div>`
                        },
                        {
                            id: 20,
                            title: '20. Finding the Average',
                            description: "Calculate the average of a list of numbers. This requires summing the elements and then performing floating-point division.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {10, 15, 20, 25, 30};\n        double sum = 0.0;\n\n        // First, loop through the numbers and calculate the sum.\n\n\n        // Next, calculate the average.\n        // To get an accurate decimal result, make sure to divide by a double.\n        double average = sum / numbers.length;\n\n        System.out.println("The average is: " + average);\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {10, 15, 20, 25, 30};\n        double sum = 0.0;\n\n        // First, loop through the numbers and calculate the sum.\n        for (int number : numbers) {\n            sum += number;\n        }\n\n        // Next, calculate the average.\n        // To get an accurate decimal result, make sure to divide by a double.\n        double average = sum / numbers.length;\n\n        System.out.println("The average is: " + average);\n    }\n}`,
                            expectedOutput: 'The average is: 20.0',
                            tutorial: `<p class="mb-4 text-gray-300">Calculating an average involves two steps: finding the sum of all elements, and then dividing by the number of elements.</p><p class="mb-4 text-gray-300">A key concept in Java is integer division versus floating-point (double) division. If you divide an integer by an integer, Java will truncate the result (e.g., <code>5 / 2</code> is <code>2</code>). To get a precise decimal answer, at least one of the numbers in the division must be a double. We can do this by making our <code>sum</code> variable a double from the start.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int a = 7;\nint b = 2;\nSystem.out.println(a / b); // Prints 3 (integer division)\n\ndouble c = 7.0;\nSystem.out.println(c / b); // Prints 3.5 (floating-point division)</pre></div>`
                        },
                        {
                            id: 21,
                            title: '21. Inheritance (extends)',
                            description: "Inheritance allows a new class (subclass) to inherit properties and methods from an existing class (superclass). Create a `Dog` class that inherits from `Animal`.",
                            initialCode: `class Animal {\n    public void eat() {\n        System.out.println("This animal eats food.");\n    }\n}\n\n// Create a Dog class that extends Animal\n// Add a method called bark() that prints "Woof!"\n\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new Dog object\n\n        // Call the eat() method (from Animal)\n\n        // Call the bark() method (from Dog)\n\n    }\n}`,
                            fullSolution: `class Animal {\n    public void eat() {\n        System.out.println("This animal eats food.");\n    }\n}\n\n// Create a Dog class that extends Animal\nclass Dog extends Animal {\n    // Add a method called bark() that prints "Woof!"\n    public void bark() {\n        System.out.println("Woof!");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new Dog object\n        Dog myDog = new Dog();\n\n        // Call the eat() method (from Animal)\n        myDog.eat();\n\n        // Call the bark() method (from Dog)\n        myDog.bark();\n    }\n}`,
                            expectedOutput: 'This animal eats food.\nWoof!',
                            tutorial: `<p class="mb-4 text-gray-300"><strong>Inheritance</strong> is a core principle of Object-Oriented Programming. It allows us to create a new class that is a modified version of an existing class. The new class (the <em>subclass</em>) inherits the fields and methods of the existing class (the <em>superclass</em>).</p><p class="mb-4 text-gray-300">We use the <code>extends</code> keyword to do this. This promotes code reuse and creates a logical hierarchy.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// Superclass\nclass Vehicle {\n    public void drive() {\n        System.out.println("Driving a vehicle.");\n    }\n}\n\n// Subclass\nclass Car extends Vehicle {\n    public void honk() {\n        System.out.println("Beep beep!");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Car myCar = new Car();\n        myCar.drive(); // Inherited from Vehicle\n        myCar.honk();  // Defined in Car\n    }\n}</pre></div>`
                        },
                        {
                            id: 22,
                            title: '22. Polymorphism & Overriding',
                            description: "Polymorphism allows objects of different classes to be treated as objects of a common superclass. This is often achieved by overriding methods.",
                            initialCode: `class Animal {\n    public void makeSound() {\n        System.out.println("Some generic animal sound");\n    }\n}\n\nclass Dog extends Animal {\n    // Override the makeSound method to print "Bark!"\n\n}\n\nclass Cat extends Animal {\n    // Override the makeSound method to print "Meow!"\n\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Animal myDog = new Dog();\n        Animal myCat = new Cat();\n        \n        myDog.makeSound();\n        myCat.makeSound();\n    }\n}`,
                            fullSolution: `class Animal {\n    public void makeSound() {\n        System.out.println("Some generic animal sound");\n    }\n}\n\nclass Dog extends Animal {\n    // Override the makeSound method to print "Bark!"\n    @Override\n    public void makeSound() {\n        System.out.println("Bark!");\n    }\n}\n\nclass Cat extends Animal {\n    // Override the makeSound method to print "Meow!"\n    @Override\n    public void makeSound() {\n        System.out.println("Meow!");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Animal myDog = new Dog();\n        Animal myCat = new Cat();\n        \n        myDog.makeSound();\n        myCat.makeSound();\n    }\n}`,
                            expectedOutput: 'Bark!\nMeow!',
                            tutorial: `<p class="mb-4 text-gray-300"><strong>Polymorphism</strong> means "many forms". In Java, it means you can perform a single action in different ways. A common way to use it is when a superclass reference variable is used to refer to a subclass object.</p><p class="mb-4 text-gray-300">Method <strong>overriding</strong> is when a subclass provides a specific implementation for a method that is already defined in its superclass. The <code>@Override</code> annotation is used to indicate this; it's not required but is good practice as it helps the compiler catch errors.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">class Shape {\n    public void draw() {\n        System.out.println("Drawing a shape");\n    }\n}\n\nclass Circle extends Shape {\n    @Override\n    public void draw() {\n        System.out.println("Drawing a circle");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Shape myShape = new Circle(); // Polymorphism!\n        myShape.draw(); // Calls the Circle's draw() method\n    }\n}</pre></div>`
                        },
                        {
                            id: 23,
                            title: '23. ArrayList',
                            description: "An `ArrayList` is a resizable array, part of the Java Collections Framework. It's more flexible than a standard array.",
                            initialCode: `import java.util.ArrayList;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create an ArrayList that can hold Strings\n        ArrayList<String> fruits = new ArrayList<>();\n\n        // Add "Apple", "Banana", and "Cherry" to the list\n\n\n        // Print the element at index 1\n\n    }\n}`,
                            fullSolution: `import java.util.ArrayList;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create an ArrayList that can hold Strings\n        ArrayList<String> fruits = new ArrayList<>();\n\n        // Add "Apple", "Banana", and "Cherry" to the list\n        fruits.add("Apple");\n        fruits.add("Banana");\n        fruits.add("Cherry");\n\n        // Print the element at index 1\n        System.out.println(fruits.get(1));\n    }\n}`,
                            expectedOutput: 'Banana',
                            tutorial: `<p class="mb-4 text-gray-300">While arrays are useful, their size is fixed once created. The <code>ArrayList</code> class provides a way to have a dynamic, resizable list of objects.</p><p class="mb-4 text-gray-300">You must import it from <code>java.util.ArrayList</code>. Here are some common methods:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>add(element)</code>: Adds an element to the end of the list.</li><li><code>get(index)</code>: Returns the element at the specified index.</li><li><code>size()</code>: Returns the number of elements in the list.</li><li><code>remove(index)</code>: Removes the element at the specified index.</li><li><code>set(index, element)</code>: Replaces the element at the specified index with a new one.</li></ul>`
                        },
                        {
                            id: 24,
                            title: '24. Interfaces',
                            description: "An interface is a completely abstract type that is used to group related methods with empty bodies. A class can `implement` an interface, promising to provide the code for its methods.",
                            initialCode: `// An interface is a contract for what a class can do.\ninterface Animal {\n    public void makeSound(); // No method body\n    public void sleep();\n}\n\n// This class must provide code for the Animal methods.\nclass Pig implements Animal {\n    // Provide the implementation for makeSound()\n\n    // Provide the implementation for sleep()\n\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Pig myPig = new Pig();\n        myPig.makeSound();\n        myPig.sleep();\n    }\n}`,
                            fullSolution: `// An interface is a contract for what a class can do.\ninterface Animal {\n    public void makeSound(); // No method body\n    public void sleep();\n}\n\n// This class must provide code for the Animal methods.\nclass Pig implements Animal {\n    // Provide the implementation for makeSound()\n    public void makeSound() {\n        System.out.println("The pig says: wee wee");\n    }\n    // Provide the implementation for sleep()\n    public void sleep() {\n        System.out.println("Zzz");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Pig myPig = new Pig();\n        myPig.makeSound();\n        myPig.sleep();\n    }\n}`,
                            expectedOutput: 'The pig says: wee wee\nZzz',
                            tutorial: `<p class="mb-4 text-gray-300">An <strong>interface</strong> is like a blueprint for a class. It can only contain abstract methods (methods without a body) and constants. A class can <code>implement</code> one or more interfaces.</p><p class="mb-4 text-gray-300">This is Java's way of achieving full abstraction and is a key part of designing large, flexible applications. It defines a "contract" that a class must follow if it implements the interface.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">interface Drivable {\n    public void startEngine();\n}\n\nclass Car implements Drivable {\n    public void startEngine() {\n        System.out.println("Car engine started.");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Car myCar = new Car();\n        myCar.startEngine();\n    }\n}</pre></div>`
                        },
                        {
                            id: 25,
                            title: '25. Exception Handling (try-catch)',
                            description: "Robust programs must handle potential errors gracefully. Use a `try-catch` block to prevent a crash when trying to divide by zero.",
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Use a try-catch block to handle the potential error.\n        try {\n            int result = 10 / 0;\n            System.out.println(result);\n        } catch (Exception e) {\n            // In the catch block, print "Error: Cannot divide by zero."\n\n        }\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Use a try-catch block to handle the potential error.\n        try {\n            int result = 10 / 0;\n            System.out.println(result);\n        } catch (Exception e) {\n            // In the catch block, print "Error: Cannot divide by zero."\n            System.out.println("Error: Cannot divide by zero.");\n        }\n    }\n}`,
                            expectedOutput: 'Error: Cannot divide by zero.',
                            tutorial: `<p class="mb-4 text-gray-300">An <strong>exception</strong> is an event that disrupts the normal flow of a program. Java's exception handling mechanism allows you to manage these errors without crashing the application.</p><p class="mb-4 text-gray-300">The <code>try</code> block contains the code that might throw an exception. The <code>catch</code> block contains the code that is executed if an exception of a specific type occurs in the <code>try</code> block.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">public class Main {\n    public static void main(String[] args) {\n        int[] numbers = {1, 2, 3};\n        try {\n            // This line will cause an ArrayIndexOutOfBoundsException\n            System.out.println(numbers[10]);\n        } catch (Exception e) {\n            // This block runs instead of the program crashing\n            System.out.println("Something went wrong.");\n        }\n    }\n}</pre></div>`
                        },
                        {
                            id: 26,
                            title: '26. HashMap',
                            description: 'A `HashMap` stores items in "key/value" pairs. Create a HashMap to store capital cities, add a few pairs, and then retrieve a value using its key.',
                            initialCode: `import java.util.HashMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a HashMap to store String keys and String values\n        HashMap<String, String> capitalCities = new HashMap<>();\n\n        // Add some key-value pairs\n        capitalCities.put("England", "London");\n        capitalCities.put("Germany", "Berlin");\n        capitalCities.put("Japan", "Tokyo");\n\n        // Retrieve and print the capital of Germany\n\n    }\n}`,
                            fullSolution: `import java.util.HashMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a HashMap to store String keys and String values\n        HashMap<String, String> capitalCities = new HashMap<>();\n\n        // Add some key-value pairs\n        capitalCities.put("England", "London");\n        capitalCities.put("Germany", "Berlin");\n        capitalCities.put("Japan", "Tokyo");\n\n        // Retrieve and print the capital of Germany\n        System.out.println(capitalCities.get("Germany"));\n    }\n}`,
                            expectedOutput: 'Berlin',
                            tutorial: `<p class="mb-4 text-gray-300">A <code>HashMap</code> is a powerful data structure for storing key-value pairs, similar to a dictionary. Each value is associated with a unique key. It's incredibly fast for looking up values when you know the key.</p><p class="mb-4 text-gray-300">Like <code>ArrayList</code>, you must import it from <code>java.util.HashMap</code>. Common methods include:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>put(key, value)</code>: Adds a key-value pair.</li><li><code>get(key)</code>: Returns the value associated with the key.</li><li><code>remove(key)</code>: Removes the key-value pair.</li><li><code>size()</code>: Returns the number of pairs.</li></ul>`
                        },
                        {
                            id: 27,
                            title: '27. String Methods',
                            description: 'The `String` class has many useful methods. Use `length()`, `toUpperCase()`, and `substring()` to manipulate a string and print the results.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        String text = "Hello Java";\n\n        // Print the length of the string\n\n        // Print the string in all uppercase letters\n\n        // Print the substring "Java"\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        String text = "Hello Java";\n\n        // Print the length of the string\n        System.out.println("Length: " + text.length());\n\n        // Print the string in all uppercase letters\n        System.out.println("Uppercase: " + text.toUpperCase());\n\n        // Print the substring "Java"\n        System.out.println("Substring: " + text.substring(6));\n    }\n}`,
                            expectedOutput: 'Length: 10\nUppercase: HELLO JAVA\nSubstring: Java',
                            tutorial: `<p class="mb-4 text-gray-300">Strings in Java are objects, and they come with many built-in methods for common operations.</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>length()</code>: Returns the number of characters in the string.</li><li><code>toUpperCase()</code> / <code>toLowerCase()</code>: Returns a new string in the specified case.</li><li><code>substring(startIndex)</code>: Returns a new string from the start index to the end.</li><li><code>substring(startIndex, endIndex)</code>: Returns a new string from the start index up to (but not including) the end index.</li></ul><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">String greeting = "Welcome!";\nSystem.out.println(greeting.length()); // Prints 8\nSystem.out.println(greeting.substring(0, 3)); // Prints "Wel"</pre></div>`
                        },
                        {
                            id: 28,
                            title: '28. Math Class',
                            description: 'The `Math` class contains methods for performing basic numeric operations. Use `Math.max()` and `Math.sqrt()` to find the larger of two numbers and the square root of another.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Find the larger of 25 and 42 using Math.max()\n        System.out.println("Max: " + Math.max(25, 42));\n\n        // Find the square root of 64 using Math.sqrt()\n        System.out.println("Sqrt: " + Math.sqrt(64));\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Find the larger of 25 and 42 using Math.max()\n        System.out.println("Max: " + Math.max(25, 42));\n\n        // Find the square root of 64 using Math.sqrt()\n        System.out.println("Sqrt: " + Math.sqrt(64));\n    }\n}`,
                            expectedOutput: 'Max: 42\nSqrt: 8.0',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>Math</code> class provides a collection of static methods for mathematical calculations. You don't need to create an object of the Math class; you can call its methods directly.</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>Math.max(a, b)</code>: Returns the largest of two values.</li><li><code>Math.min(a, b)</code>: Returns the smallest of two values.</li><li><code>Math.sqrt(n)</code>: Returns the square root of a number.</li><li><code>Math.random()</code>: Returns a random double between 0.0 and 1.0.</li><li><code>Math.abs(n)</code>: Returns the absolute (non-negative) value.</li></ul>`
                        },
                        {
                            id: 29,
                            title: '29. StringBuilder',
                            description: 'When you need to build a string by appending many parts, `StringBuilder` is more efficient than regular string concatenation. Use it to build a sentence.',
                            initialCode: `import java.lang.StringBuilder;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new StringBuilder\n        StringBuilder builder = new StringBuilder();\n\n        // Append parts of a sentence\n        builder.append("Java ");\n        builder.append("is ");\n        builder.append("efficient!");\n\n        // Convert the StringBuilder back to a String and print it\n\n    }\n}`,
                            fullSolution: `import java.lang.StringBuilder;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Create a new StringBuilder\n        StringBuilder builder = new StringBuilder();\n\n        // Append parts of a sentence\n        builder.append("Java ");\n        builder.append("is ");\n        builder.append("efficient!");\n\n        // Convert the StringBuilder back to a String and print it\n        String result = builder.toString();\n        System.out.println(result);\n    }\n}`,
                            expectedOutput: 'Java is efficient!',
                            tutorial: `<p class="mb-4 text-gray-300">Every time you use the <code>+</code> operator to concatenate strings, Java creates a new string object in memory. This can be inefficient if you do it many times in a loop. <code>StringBuilder</code> is a mutable object that allows you to modify a sequence of characters without creating new objects for each change.</p><p class="mb-4 text-gray-300">Use <code>append()</code> to add to the string. When you are finished, call <code>toString()</code> to get the final <code>String</code> object.</p>`
                        },
                        {
                            id: 30,
                            title: '30. The `super` Keyword',
                            description: 'The `super` keyword refers to the superclass. It can be used to call the superclass\'s constructor or methods. Call the `Animal` constructor from the `Dog` constructor.',
                            initialCode: `class Animal {\n    String name;\n    public Animal(String name) {\n        this.name = name;\n        System.out.println("Animal constructor called for: " + name);\n    }\n}\n\nclass Dog extends Animal {\n    public Dog(String name) {\n        // Use 'super' to call the constructor of the Animal class\n        // Pass the 'name' variable to it.\n\n        System.out.println("Dog constructor called.");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Dog myDog = new Dog("Fido");\n    }\n}`,
                            fullSolution: `class Animal {\n    String name;\n    public Animal(String name) {\n        this.name = name;\n        System.out.println("Animal constructor called for: " + name);\n    }\n}\n\nclass Dog extends Animal {\n    public Dog(String name) {\n        // Use 'super' to call the constructor of the Animal class\n        // Pass the 'name' variable to it.\n        super(name);\n        System.out.println("Dog constructor called.");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Dog myDog = new Dog("Fido");\n    }\n}`,
                            expectedOutput: 'Animal constructor called for: Fido\nDog constructor called.',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>super</code> keyword is used inside a subclass to refer to its immediate parent (superclass). There are two main uses:</p><ol class="list-decimal list-inside mb-4 text-gray-300 space-y-2"><li><code>super(arguments)</code>: To call a constructor of the superclass. If used, it <strong>must</strong> be the very first statement in the subclass constructor.</li><li><code>super.methodName()</code>: To call a method of the superclass, which is useful if the subclass has overridden that method but you still need the original behavior.</li></ol>`
                        },
                        {
                            id: 31,
                            title: '31. Method Overloading',
                            description: 'Method overloading allows you to define multiple methods with the same name in the same class, as long as they have different parameters. Create two `add` methods: one for integers and one for doubles.',
                            initialCode: `public class Main {\n\n    // Method to add two integers\n    public static int add(int a, int b) {\n        return a + b;\n    }\n\n    // Overload the add method to handle two doubles\n\n\n    public static void main(String[] args) {\n        int intSum = add(5, 10);\n        double doubleSum = add(3.5, 4.5);\n\n        System.out.println("Integer sum: " + intSum);\n        System.out.println("Double sum: " + doubleSum);\n    }\n}`,
                            fullSolution: `public class Main {\n\n    // Method to add two integers\n    public static int add(int a, int b) {\n        return a + b;\n    }\n\n    // Overload the add method to handle two doubles\n    public static double add(double a, double b) {\n        return a + b;\n    }\n\n    public static void main(String[] args) {\n        int intSum = add(5, 10);\n        double doubleSum = add(3.5, 4.5);\n\n        System.out.println("Integer sum: " + intSum);\n        System.out.println("Double sum: " + doubleSum);\n    }\n}`,
                            expectedOutput: 'Integer sum: 15\nDouble sum: 8.0',
                            tutorial: `<p class="mb-4 text-gray-300"><strong>Method Overloading</strong> increases the readability of the program. It allows you to have multiple methods with the same name as long as their parameter lists are different (either by the number of parameters, the type of parameters, or both).</p><p class="mb-4 text-gray-300">Java determines which version of the method to call based on the arguments you provide.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">public void display(int a) {\n    System.out.println("Got an Integer: " + a);\n}\n\npublic void display(String s) {\n    System.out.println("Got a String: " + s);\n}\n\ndisplay(100); // Calls the first method\ndisplay("Hello"); // Calls the second method</pre></div>`
                        },
                        {
                            id: 32,
                            title: '32. Abstract Classes',
                            description: 'An abstract class cannot be instantiated and can contain abstract methods (without a body). Create an abstract `Shape` class and a `Circle` subclass that implements its abstract method.',
                            initialCode: `// Abstract class\nabstract class Shape {\n    // Abstract method (does not have a body)\n    public abstract void draw();\n\n    // Regular method\n    public void moveTo() {\n        System.out.println("Shape moved.");\n    }\n}\n\n// Subclass (inherits from Shape)\nclass Circle extends Shape {\n    // Provide an implementation for the abstract draw() method\n\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Circle myCircle = new Circle();\n        myCircle.draw();\n        myCircle.moveTo();\n    }\n}`,
                            fullSolution: `// Abstract class\nabstract class Shape {\n    // Abstract method (does not have a body)\n    public abstract void draw();\n\n    // Regular method\n    public void moveTo() {\n        System.out.println("Shape moved.");\n    }\n}\n\n// Subclass (inherits from Shape)\nclass Circle extends Shape {\n    // Provide an implementation for the abstract draw() method\n    public void draw() {\n        System.out.println("Drawing a circle.");\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Circle myCircle = new Circle();\n        myCircle.draw();\n        myCircle.moveTo();\n    }\n}`,
                            expectedOutput: 'Drawing a circle.\nShape moved.',
                            tutorial: `<p class="mb-4 text-gray-300">An <strong>abstract class</strong> is a restricted class that cannot be used to create objects. It serves as a base for subclasses. It can have both abstract and non-abstract (regular) methods.</p><p class="mb-4 text-gray-300">An <strong>abstract method</strong> is a method that is declared without an implementation. Any subclass of an abstract class must either implement all of the superclass's abstract methods or be declared abstract itself.</p><p class="mb-4 text-gray-300">This provides a middle ground between a regular class and an interface.</p>`
                        },
                        {
                            id: 33,
                            title: '33. Type Casting',
                            description: 'Type casting is when you assign a value of one primitive data type to another type. Perform both widening (automatic) and narrowing (manual) casting.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Widening Casting (int to double)\n        int myInt = 9;\n        double myDouble = myInt; // Automatic casting\n        System.out.println(myDouble);\n\n        // Narrowing Casting (double to int)\n        double anotherDouble = 9.78;\n        // Manually cast the double to an int and store it in anotherInt\n        int anotherInt = (int) anotherDouble;\n\n        System.out.println(anotherInt);\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Widening Casting (int to double)\n        int myInt = 9;\n        double myDouble = myInt; // Automatic casting\n        System.out.println(myDouble);\n\n        // Narrowing Casting (double to int)\n        double anotherDouble = 9.78;\n        // Manually cast the double to an int and store it in anotherInt\n        int anotherInt = (int) anotherDouble;\n\n        System.out.println(anotherInt);\n    }\n}`,
                            expectedOutput: '9.0\n9',
                            tutorial: `<p class="mb-4 text-gray-300">Type casting is used to convert variables from one data type to another.</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li><strong>Widening Casting</strong>: Happens automatically when passing a smaller size type to a larger size type (e.g., <code>int</code> to <code>double</code>). This is safe as there is no data loss.</li><li><strong>Narrowing Casting</strong>: Must be done manually by placing the type in parentheses in front of the value (e.g., <code>(int)</code>). This can lead to data loss, as you are fitting a larger type into a smaller one. For example, casting a <code>double</code> to an <code>int</code> will truncate the decimal part.</li></ul>`
                        },
                        {
                            id: 34,
                            title: '34. Ternary Operator',
                            description: 'The ternary operator is a shorthand for an if-else statement. Use it to assign a value to the `result` string based on a condition.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int time = 20;\n        String result;\n\n        // Use the ternary operator to set 'result'.\n        // If time < 18, it should be "Good day."\n        // Otherwise, it should be "Good evening."\n        result = (time < 18) ? "Good day." : "Good evening.";\n\n        System.out.println(result);\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int time = 20;\n        String result;\n\n        // Use the ternary operator to set 'result'.\n        // If time < 18, it should be "Good day."\n        // Otherwise, it should be "Good evening."\n        result = (time < 18) ? "Good day." : "Good evening.";\n\n        System.out.println(result);\n    }\n}`,
                            expectedOutput: 'Good evening.',
                            tutorial: `<p class="mb-4 text-gray-300">The ternary operator provides a concise way to write simple conditional assignments. Its syntax is:</p><p class="mb-4 text-gray-300"><code>variable = (condition) ? valueIfTrue : valueIfFalse;</code></p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// Using if-else\nint x = 10;\nString message;\nif (x > 5) {\n    message = "x is greater than 5";\n} else {\n    message = "x is not greater than 5";\n}\n\n// Using ternary operator (equivalent)\nString message2 = (x > 5) ? "x is greater than 5" : "x is not greater than 5";</pre></div>`
                        },
                        {
                            id: 35,
                            title: '35. Do-While Loop',
                            description: 'A `do-while` loop is a variant of the while loop which executes the code block once before checking the condition. Use it to print a countdown that includes 0.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int i = 3;\n\n        // Create a do-while loop that prints 'i' and decrements it.\n        // The loop should continue as long as i is greater than or equal to 0.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int i = 3;\n\n        // Create a do-while loop that prints 'i' and decrements it.\n        // The loop should continue as long as i is greater than or equal to 0.\n        do {\n            System.out.println(i);\n            i--;\n        } while (i >= 0);\n    }\n}`,
                            expectedOutput: '3\n2\n1\n0',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>do-while</code> loop is similar to a <code>while</code> loop, but with one key difference: the condition is checked <em>after</em> the loop body is executed. This guarantees that the loop will run at least once, regardless of whether the condition is true or false.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">int count = 5;\n\ndo {\n    System.out.println("This will print at least once.");\n} while (count < 3); // Condition is false, but loop ran once.</pre></div>`
                        },
                        {
                            id: 36,
                            title: '36. Wrapper Classes',
                            description: 'Wrapper classes provide a way to use primitive data types (like `int`) as objects. Create an `Integer` object and use one of its methods.',
                            initialCode: `import java.util.ArrayList;\n\npublic class Main {\n    public static void main(String[] args) {\n        // ArrayLists cannot store primitives, they need objects.\n        ArrayList<Integer> myNumbers = new ArrayList<>();\n\n        // Create an Integer wrapper object\n        Integer myInt = 500;\n\n        // Add it to the list\n        myNumbers.add(myInt);\n\n        // Use a method from the Integer wrapper class, like toString(), and print it.\n\n    }\n}`,
                            fullSolution: `import java.util.ArrayList;\n\npublic class Main {\n    public static void main(String[] args) {\n        // ArrayLists cannot store primitives, they need objects.\n        ArrayList<Integer> myNumbers = new ArrayList<>();\n\n        // Create an Integer wrapper object\n        Integer myInt = 500;\n\n        // Add it to the list\n        myNumbers.add(myInt);\n\n        // Use a method from the Integer wrapper class, like toString(), and print it.\n        String intAsString = myInt.toString();\n        System.out.println("String length: " + intAsString.length());\n    }\n}`,
                            expectedOutput: 'String length: 3',
                            tutorial: `<p class="mb-4 text-gray-300">Java has two categories of data types: primitive types and reference types (objects). Sometimes you need to treat a primitive like an object, for example, when using it with collections like <code>ArrayList</code>. Wrapper classes solve this problem.</p><p class="mb-4 text-gray-300">Each primitive has a corresponding wrapper class:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>int</code> -> <code>Integer</code></li><li><code>double</code> -> <code>Double</code></li><li><code>char</code> -> <code>Character</code></li><li><code>boolean</code> -> <code>Boolean</code></li></ul><p class="mb-4 text-gray-300">The process of converting a primitive to a wrapper object is called <strong>autoboxing</strong>, and the reverse is called <strong>unboxing</strong>. Java often does this automatically for you.</p>`
                        },
                        {
                            id: 37,
                            title: '37. Recursion',
                            description: 'Recursion is the technique of making a function call itself. Create a recursive function to calculate the sum of all numbers up to n.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int result = sum(5);\n        System.out.println(result);\n    }\n\n    // Create the recursive sum method\n    public static int sum(int k) {\n        // The base case: if k is 0, stop and return 0.\n\n        // The recursive step: return k + the sum of all numbers below k.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int result = sum(5);\n        System.out.println(result);\n    }\n\n    // Create the recursive sum method\n    public static int sum(int k) {\n        // The base case: if k is 0, stop and return 0.\n        if (k > 0) {\n            // The recursive step: return k + the sum of all numbers below k.\n            return k + sum(k - 1);\n        } else {\n            return 0;\n        }\n    }\n}`,
                            expectedOutput: '15',
                            tutorial: `<p class="mb-4 text-gray-300">Recursion is a powerful but tricky concept where a method calls itself to solve a problem. It breaks a complex problem into smaller, identical subproblems.</p><p class="mb-4 text-gray-300">Every recursive function must have two parts:</p><ol class="list-decimal list-inside mb-4 text-gray-300 space-y-2"><li>A <strong>base case</strong>: A condition that stops the recursion. Without it, you'll get an infinite loop and a <code>StackOverflowError</code>.</li><li>A <strong>recursive step</strong>: The part of the function that calls itself, usually with a modified argument that brings it closer to the base case.</li></ol><p class="mb-4 text-gray-300">For this problem, summing numbers up to 5 (5+4+3+2+1) can be thought of as <code>5 + sum(4)</code>, and <code>sum(4)</code> is <code>4 + sum(3)</code>, and so on, until you reach the base case of <code>sum(0)</code>.</p>`
                        },
                        {
                            id: 38,
                            title: '38. 2D Arrays',
                            description: 'A 2D array is like a grid or a table, an array of arrays. Create a 2D array and access an element from a specific row and column.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // Create a 2D integer array (a 2x3 matrix)\n        int[][] myNumbers = { {1, 2, 3}, {4, 5, 6} };\n\n        // Access the element in the second row (index 1)\n        // and the third column (index 2).\n        // Print the result.\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // Create a 2D integer array (a 2x3 matrix)\n        int[][] myNumbers = { {1, 2, 3}, {4, 5, 6} };\n\n        // Access the element in the second row (index 1)\n        // and the third column (index 2).\n        // Print the result.\n        int value = myNumbers[1][2];\n        System.out.println(value);\n    }\n}`,
                            expectedOutput: '6',
                            tutorial: `<p class="mb-4 text-gray-300">A 2D array is an array where each element is itself another array. It's useful for representing data in a grid-like structure, such as a tic-tac-toe board or a spreadsheet.</p><p class="mb-4 text-gray-300">You declare it with two sets of square brackets (e.g., <code>int[][]</code>). To access an element, you provide two indices: the first for the row and the second for the column.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">String[][] board = {\n    {"X", "O", "X"},\n    {"O", "X", "O"},\n    {"X", "O", "X"}\n};\n\n// Access the middle element (row 1, column 1)\nSystem.out.println(board[1][1]); // Prints "X"</pre></div>`
                        },
                        {
                            id: 39,
                            title: '39. Looping Through 2D Arrays',
                            description: 'To iterate over all elements in a 2D array, you need nested loops: one for the rows and one for the columns.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        int[][] myNumbers = { {1, 2, 3}, {4, 5, 6} };\n\n        // Use nested for loops to print all elements.\n        // The outer loop iterates through the rows (myNumbers.length).\n        // The inner loop iterates through the columns of the current row (myNumbers[i].length).\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        int[][] myNumbers = { {1, 2, 3}, {4, 5, 6} };\n\n        // Use nested for loops to print all elements.\n        // The outer loop iterates through the rows (myNumbers.length).\n        // The inner loop iterates through the columns of the current row (myNumbers[i].length).\n        for (int i = 0; i < myNumbers.length; i++) {\n            for (int j = 0; j < myNumbers[i].length; j++) {\n                System.out.println(myNumbers[i][j]);\n            }\n        }\n    }\n}`,
                            expectedOutput: '1\n2\n3\n4\n5\n6',
                            tutorial: `<p class="mb-4 text-gray-300">To process every element in a 2D array, a common pattern is to use a "nested loop" — a loop inside another loop.</p><p class="mb-4 text-gray-300">The outer loop iterates through each of the main arrays (the rows). The inner loop then iterates through all the elements within that specific row-array (the columns).</p><h4 class="font-semibold text-gray-200 mb-2">Example with for-each loops:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">String[][] data = {{"A", "B"}, {"C", "D"}};\n\nfor (String[] row : data) {\n    for (String element : row) {\n        System.out.print(element + " "); // Prints "A B C D "\n    }\n}</pre></div>`
                        },
                        {
                            id: 40,
                            title: '40. The `final` Keyword',
                            description: 'The `final` keyword is used to make a variable a constant, meaning its value cannot be changed. Try to change a final variable to see the error, then fix it by removing the attempt to change it.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        // A final variable's value cannot be changed.\n        final int MY_NUMBER = 15;\n\n        // This line will cause a compilation error. \n        // To pass the lesson, remove or comment out this line.\n        MY_NUMBER = 20;\n\n        System.out.println(MY_NUMBER);\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        // A final variable's value cannot be changed.\n        final int MY_NUMBER = 15;\n\n        // This line will cause a compilation error. \n        // To pass the lesson, remove or comment out this line.\n        // MY_NUMBER = 20;\n\n        System.out.println(MY_NUMBER);\n    }\n}`,
                            expectedOutput: '15',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>final</code> keyword is a non-access modifier used for classes, methods, and variables. It has different meanings depending on the context:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li><strong>final variable</strong>: Creates a constant. Its value cannot be changed after it has been assigned. By convention, constant names are written in all uppercase letters.</li><li><strong>final method</strong>: Cannot be overridden by a subclass.</li><li><strong>final class</strong>: Cannot be extended (inherited from) by another class.</li></ul><p class="mb-4 text-gray-300">This lesson focuses on final variables. Attempting to reassign a final variable will result in a compile-time error.</p>`
                        },
                        {
                            id: 41,
                            title: '41. Enums',
                            description: 'An enum is a special "class" that represents a group of constants. Define an enum for difficulty levels and use it in a switch statement.',
                            initialCode: `// Define an enum for game difficulty levels\nenum Level {\n    EASY,\n    MEDIUM,\n    HARD\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Level myLevel = Level.MEDIUM;\n\n        // Use a switch statement to print a message based on the level\n\n    }\n}`,
                            fullSolution: `// Define an enum for game difficulty levels\nenum Level {\n    EASY,\n    MEDIUM,\n    HARD\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Level myLevel = Level.MEDIUM;\n\n        // Use a switch statement to print a message based on the level\n        switch(myLevel) {\n            case EASY:\n                System.out.println("Easy level");\n                break;\n            case MEDIUM:\n                System.out.println("Medium level");\n                break;\n            case HARD:\n                System.out.println("Hard level");\n                break;\n        }\n    }\n}`,
                            expectedOutput: 'Medium level',
                            tutorial: `<p class="mb-4 text-gray-300">An <code>enum</code> (short for enumeration) is a special data type that enables for a variable to be a set of predefined constants. The variable must be equal to one of the values that have been predefined for it.</p><p class="mb-4 text-gray-300">Enums are useful when you have a value that you know is one of a small, fixed set of possibilities, such as days of the week, compass directions, or states in a game. They make code more readable and prevent errors from using invalid values.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">enum Direction {\n    NORTH, SOUTH, EAST, WEST\n}\n\nDirection myDir = Direction.NORTH;\n\nif (myDir == Direction.NORTH) {\n    System.out.println("Heading North!");\n}</pre></div>`
                        },
                        {
                            id: 42,
                            title: '42. Access Modifiers (private)',
                            description: 'Access modifiers control the visibility of classes, fields, and methods. Use the `private` keyword to encapsulate data and provide public getter/setter methods.',
                            initialCode: `class Person {\n    // Make the 'name' variable private\n    public String name;\n\n    // Public getter method\n    public String getName() {\n        return name;\n    }\n\n    // Public setter method\n    public void setName(String newName) {\n        this.name = newName;\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Person myPerson = new Person();\n        // This would cause an error if 'name' were private: myPerson.name = "John";\n        \n        // Use the setter to change the name\n\n        // Use the getter to retrieve and print the name\n\n    }\n}`,
                            fullSolution: `class Person {\n    // Make the 'name' variable private\n    private String name;\n\n    // Public getter method\n    public String getName() {\n        return name;\n    }\n\n    // Public setter method\n    public void setName(String newName) {\n        this.name = newName;\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Person myPerson = new Person();\n        // This would cause an error if 'name' were private: myPerson.name = "John";\n        \n        // Use the setter to change the name\n        myPerson.setName("Alice");\n\n        // Use the getter to retrieve and print the name\n        System.out.println(myPerson.getName());\n    }\n}`,
                            expectedOutput: 'Alice',
                            tutorial: `<p class="mb-4 text-gray-300">Java has four access modifiers:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li><code>public</code>: The code is accessible for all classes.</li><li><code>private</code>: The code is only accessible within the declared class.</li><li><code>protected</code>: The code is accessible in the same package and subclasses.</li><li><strong>default</strong> (no keyword): The code is only accessible in the same package.</li></ul><p class="mb-4 text-gray-300">The <code>private</code> modifier is central to the concept of <strong>encapsulation</strong>. It hides sensitive data from the outside world. To access or modify private data, you provide public "getter" and "setter" methods.</p>`
                        },
                        {
                            id: 43,
                            title: '43. The `continue` Keyword',
                            description: 'The `continue` statement breaks one iteration (in the loop), if a specified condition occurs, and continues with the next iteration in the loop. Use it to print only the odd numbers.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        for (int i = 0; i < 10; i++) {\n            // If 'i' is an even number, skip this iteration\n            if (i % 2 == 0) {\n                \n            }\n            System.out.println(i);\n        }\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        for (int i = 0; i < 10; i++) {\n            // If 'i' is an even number, skip this iteration\n            if (i % 2 == 0) {\n                continue;\n            }\n            System.out.println(i);\n        }\n    }\n}`,
                            expectedOutput: '1\n3\n5\n7\n9',
                            tutorial: `<p class="mb-4 text-gray-300">While <code>break</code> exits a loop entirely, <code>continue</code> just skips the current iteration. When the <code>continue</code> statement is executed, the program immediately jumps to the loop's next iteration, bypassing any remaining code in the current iteration.</p><h4 class="font-semibold text-gray-200 mb-2">Example:</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">// Don't print the number 5\nfor (int i = 0; i < 10; i++) {\n    if (i == 5) {\n        continue; // Skip the rest of the loop body when i is 5\n    }\n    System.out.println(i);\n}</pre></div><p class="mt-4 text-gray-300">In this lesson, you'll use the modulo operator (<code>%</code>) to check for even numbers and skip them with <code>continue</code>.</p>`
                        },
                        {
                            id: 44,
                            title: '44. Iterating through a HashMap',
                            description: 'You can loop through the keys, values, or key-value pairs of a HashMap. Use a for-each loop to print all the keys in the map.',
                            initialCode: `import java.util.HashMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        HashMap<String, String> capitalCities = new HashMap<>();\n        capitalCities.put("England", "London");\n        capitalCities.put("Germany", "Berlin");\n        capitalCities.put("Japan", "Tokyo");\n\n        // Use keySet() and a for-each loop to print each country name.\n\n    }\n}`,
                            fullSolution: `import java.util.HashMap;\n\npublic class Main {\n    public static void main(String[] args) {\n        HashMap<String, String> capitalCities = new HashMap<>();\n        capitalCities.put("England", "London");\n        capitalCities.put("Germany", "Berlin");\n        capitalCities.put("Japan", "Tokyo");\n\n        // Use keySet() and a for-each loop to print each country name.\n        for (String country : capitalCities.keySet()) {\n            System.out.println(country);\n        }\n    }\n}`,
                            expectedOutput: 'England\nGermany\nJapan',
                            tutorial: `<p class="mb-4 text-gray-300">There are several ways to loop through a <code>HashMap</code>:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li><code>keySet()</code>: Returns a set of all the keys. You can iterate through this set and use <code>get()</code> to retrieve each value.</li><li><code>values()</code>: Returns a collection of all the values. Use this if you don't need the keys.</li><li><code>entrySet()</code>: Returns a set of all key-value pairs (as <code>Map.Entry</code> objects). This is the most efficient method if you need both the key and the value in each iteration.</li></ul><h4 class="font-semibold text-gray-200 mb-2">Example using entrySet():</h4><div class="code-block-wrapper"><pre class="tutorial-code-block">for (Map.Entry<String, String> entry : capitalCities.entrySet()) {\n    System.out.println("Key: " + entry.getKey() + ", Value: " + entry.getValue());\n}</pre></div>`
                        },
                        {
                            id: 45,
                            title: '45. The `this` Keyword',
                            description: 'The `this` keyword refers to the current object instance. It is commonly used to resolve ambiguity between instance variables and parameters.',
                            initialCode: `class Car {\n    String model;\n\n    // Constructor\n    public Car(String model) {\n        // Use 'this' to distinguish between the instance variable 'model'\n        // and the parameter 'model'.\n        model = model;\n    }\n\n    public void printModel() {\n        System.out.println("Car model: " + this.model);\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Car myCar = new Car("Mustang");\n        myCar.printModel();\n    }\n}`,
                            fullSolution: `class Car {\n    String model;\n\n    // Constructor\n    public Car(String model) {\n        // Use 'this' to distinguish between the instance variable 'model'\n        // and the parameter 'model'.\n        this.model = model;\n    }\n\n    public void printModel() {\n        System.out.println("Car model: " + this.model);\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Car myCar = new Car("Mustang");\n        myCar.printModel();\n    }\n}`,
                            expectedOutput: 'Car model: Mustang',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>this</code> keyword is a reference to the current object — the object whose method or constructor is being called. It can be used to:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li>Disambiguate between instance variables and parameters when they have the same name (the most common use).</li><li>Call another constructor in the same class (e.g., <code>this(arguments)</code>).</li><li>Pass the current object as an argument in a method call.</li></ul><p class="mb-4 text-gray-300">When a parameter has the same name as an instance variable, the parameter "shadows" the instance variable. Using <code>this.variableName</code> ensures you are referring to the instance variable.</p>`
                        },
                        {
                            id: 46,
                            title: '46. Reading Numbers with Scanner',
                            description: 'The `Scanner` class can read specific data types, not just strings. Use `nextInt()` to read an integer from the user and perform a calculation.',
                            initialCode: `import java.util.Scanner;\n\npublic class Main {\n    public static void main(String[] args) {\n        Scanner scanner = new Scanner(System.in);\n        System.out.println("Enter your age:");\n\n        // Use nextInt() to read the user's age\n        int age = scanner.nextInt();\n\n        int ageInTenYears = age + 10;\n        System.out.println("In ten years, you will be " + ageInTenYears + ".");\n    }\n}`,
                            fullSolution: `import java.util.Scanner;\n\npublic class Main {\n    public static void main(String[] args) {\n        Scanner scanner = new Scanner(System.in);\n        System.out.println("Enter your age:");\n\n        // Use nextInt() to read the user's age\n        int age = scanner.nextInt();\n\n        int ageInTenYears = age + 10;\n        System.out.println("In ten years, you will be " + ageInTenYears + ".");\n    }\n}`,
                            userInput: ["25"],
                            expectedOutput: 'Enter your age:\nIn ten years, you will be 35.',
                            tutorial: `<p class="mb-4 text-gray-300">Besides <code>nextLine()</code>, the <code>Scanner</code> class provides methods to read specific data types directly:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-1"><li><code>nextInt()</code></li><li><code>nextDouble()</code></li><li><code>nextBoolean()</code></li><li><code>next()</code> (reads the next word, not the whole line)</li></ul><p class="mb-4 text-gray-300">Using these methods can be more convenient than reading a line as a string and then converting it manually. The simulation for this lesson will provide the number "25" as input.</p>`
                        },
                        {
                            id: 47,
                            title: '47. String Comparison',
                            description: 'When comparing strings for equality, you should use the `.equals()` method, not the `==` operator. The `==` operator checks if two references point to the same object, while `.equals()` checks if the string contents are the same.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        String a = "hello";\n        String b = new String("hello");\n\n        // This will print false, because they are different objects\n        System.out.println("Using == : " + (a == b));\n\n        // Use the .equals() method to correctly compare the content of the strings\n        // and print the result.\n        System.out.print("Using .equals() : " + a.equals(b));\n\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        String a = "hello";\n        String b = new String("hello");\n\n        // This will print false, because they are different objects\n        System.out.println("Using == : " + (a == b));\n\n        // Use the .equals() method to correctly compare the content of the strings\n        // and print the result.\n        System.out.print("Using .equals() : " + a.equals(b));\n    }\n}`,
                            expectedOutput: 'Using == : false\nUsing .equals() : true',
                            tutorial: `<p class="mb-4 text-gray-300">This is a very common point of confusion for new Java programmers. For primitive types (like <code>int</code>, <code>boolean</code>), the <code>==</code> operator works as expected, comparing their values.</p><p class="mb-4 text-gray-300">However, for objects (like <code>String</code>), <code>==</code> checks if the two variables refer to the exact same object in memory. The <code>.equals()</code> method, on the other hand, is defined in the class to provide a meaningful comparison of the objects' actual contents.</p><p class="mb-4 text-gray-300"><strong>Rule of thumb:</strong> Always use <code>.equals()</code> to compare strings for equality.</p>`
                        },
                        {
                            id: 48,
                            title: '48. The `finally` Block',
                            description: 'The `finally` block in a try-catch statement always executes, regardless of whether an exception was thrown or not. It is used to run important cleanup code.',
                            initialCode: `public class Main {\n    public static void main(String[] args) {\n        try {\n            System.out.println("Inside the try block.");\n            // int x = 5 / 0; // Uncomment to see exception path\n        } catch (Exception e) {\n            System.out.println("Inside the catch block.");\n        } finally {\n            // This block will always execute. Print a message here.\n\n        }\n    }\n}`,
                            fullSolution: `public class Main {\n    public static void main(String[] args) {\n        try {\n            System.out.println("Inside the try block.");\n            // int x = 5 / 0; // Uncomment to see exception path\n        } catch (Exception e) {\n            System.out.println("Inside the catch block.");\n        } finally {\n            // This block will always execute. Print a message here.\n            System.out.println("Inside the finally block. Cleanup complete.");\n        }\n    }\n}`,
                            expectedOutput: 'Inside the try block.\nInside the finally block. Cleanup complete.',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>try-catch-finally</code> structure provides robust error handling. The flow is as follows:</p><ol class="list-decimal list-inside mb-4 text-gray-300 space-y-2"><li>The <code>try</code> block is executed.</li><li>If an exception occurs, the corresponding <code>catch</code> block is executed.</li><li>The <code>finally</code> block is <strong>always</strong> executed, whether an exception happened or not. This makes it the perfect place for cleanup code, like closing files or network connections, to ensure resources are released properly.</li></ol>`
                        },
                        {
                            id: 49,
                            title: '49. The `instanceof` Operator',
                            description: 'The `instanceof` operator checks whether an object is an instance of a specific class or an interface. Use it to determine the true type of an object.',
                            initialCode: `class Animal {}\nclass Dog extends Animal {}\nclass Cat extends Animal {}\n\npublic class Main {\n    public static void main(String[] args) {\n        Animal myPet = new Dog();\n\n        // Check if myPet is an instance of Dog\n        System.out.println("Is it a Dog? " + (myPet instanceof Dog));\n\n        // Check if myPet is an instance of Cat\n\n\n        // Check if myPet is an instance of Animal (its superclass)\n\n    }\n}`,
                            fullSolution: `class Animal {}\nclass Dog extends Animal {}\nclass Cat extends Animal {}\n\npublic class Main {\n    public static void main(String[] args) {\n        Animal myPet = new Dog();\n\n        // Check if myPet is an instance of Dog\n        System.out.println("Is it a Dog? " + (myPet instanceof Dog));\n\n        // Check if myPet is an instance of Cat\n        System.out.println("Is it a Cat? " + (myPet instanceof Cat));\n\n        // Check if myPet is an instance of Animal (its superclass)\n        System.out.println("Is it an Animal? " + (myPet instanceof Animal));\n    }\n}`,
                            expectedOutput: 'Is it a Dog? true\nIs it a Cat? false\nIs it an Animal? true',
                            tutorial: `<p class="mb-4 text-gray-300">The <code>instanceof</code> operator is a type comparison operator that returns <code>true</code> if the object on the left side is an instance of the class on the right side. It also returns <code>true</code> if the object is an instance of a subclass of the class on the right.</p><p class="mb-4 text-gray-300">This is particularly useful in polymorphism when you have a variable of a superclass type that could be holding an object of any of its subclasses, and you need to perform a specific action based on its actual type.</p>`
                        },
                        {
                            id: 50,
                            title: '50. Course Review',
                            description: 'Combine everything you have learned. Create a `Student` class, manage a list of students with an `ArrayList`, and calculate their average score.',
                            initialCode: `import java.util.ArrayList;\n\nclass Student {\n    private String name;\n    private int score;\n\n    public Student(String name, int score) {\n        this.name = name;\n        this.score = score;\n    }\n\n    public int getScore() {\n        return this.score;\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        ArrayList<Student> students = new ArrayList<>();\n        students.add(new Student("Alice", 90));\n        students.add(new Student("Bob", 80));\n        students.add(new Student("Charlie", 100));\n\n        double totalScore = 0;\n        // Loop through the students list and sum their scores\n\n\n        // Calculate and print the average score\n\n    }\n}`,
                            fullSolution: `import java.util.ArrayList;\n\nclass Student {\n    private String name;\n    private int score;\n\n    public Student(String name, int score) {\n        this.name = name;\n        this.score = score;\n    }\n\n    public int getScore() {\n        return this.score;\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        ArrayList<Student> students = new ArrayList<>();\n        students.add(new Student("Alice", 90));\n        students.add(new Student("Bob", 80));\n        students.add(new Student("Charlie", 100));\n\n        double totalScore = 0;\n        // Loop through the students list and sum their scores\n        for (Student s : students) {\n            totalScore += s.getScore();\n        }\n\n        // Calculate and print the average score\n        double average = totalScore / students.size();\n        System.out.println("Average student score: " + average);\n    }\n}`,
                            expectedOutput: 'Average student score: 90.0',
                            tutorial: `<p class="mb-4 text-gray-300">Congratulations on reaching the final review lesson! This challenge combines many of the core concepts you've learned:</p><ul class="list-disc list-inside mb-4 text-gray-300 space-y-2"><li><strong>Classes and Objects</strong>: The <code>Student</code> class with a constructor and private fields.</li><li><strong>Encapsulation</strong>: Using a getter method (<code>getScore</code>) to access private data.</li><li><strong>ArrayList</strong>: To hold a dynamic list of <code>Student</code> objects.</li><li><strong>Loops</strong>: A for-each loop to iterate through the list.</li><li><strong>Variables and Calculations</strong>: Summing the scores and calculating the average.</li></ul><p class="mb-4 text-gray-300">Solving this demonstrates a solid grasp of Java fundamentals. Well done!</p>`
                        }
                    ];
                }

                init() {
                    this.cacheDOMElements();
                    this.storageService = new LocalStorageService(this);
                    this.storageService.init();
                    this.initEditor();
                    this.addEventListeners();
                    this.addResizerLogic();
                    this.resetUI();
                    this.initProviderSelect();
                    this.initOllamaModels();
                }

                cacheDOMElements() {
                    const ids = [
                        'lesson-title', 'lesson-description', 'prev-lesson-btn', 'next-lesson-btn',
                        'run-btn', 'reset-btn', 'console-output', 'ai-ask-btn', 'ai-ask-icon',
                        'ai-input', 'ai-chat', 'ai-provider', 'ai-model', 'ai-model-refresh-btn', 'progress-label', 'progress-bar', 'lesson-status',
                        'view-tutorial-btn', 'tutorial-modal', 'tutorial-modal-bg', 'tutorial-modal-content',
                        'tutorial-title', 'tutorial-body', 'close-tutorial-btn', 'editor-placeholder',
                        'editor', 'search-btn', 'format-btn', 'confirm-modal', 'confirm-modal-bg',
                        'confirm-modal-content', 'confirm-modal-title', 'confirm-modal-text',
                        'confirm-modal-cancel-btn', 'confirm-modal-confirm-btn', 'toast-container',
                        'clear-console-btn', 'db-status-light', 'db-status-text', 'reset-progress-btn',
                        'left-panel', 'right-panel', 'resizer', 'lesson-sidebar', 'sidebar-toggle-btn',
                        'lesson-list', 'confetti-canvas', 'solve-btn'
                    ];
                    ids.forEach(id => {
                        const camelCaseId = id.replace(/-(\w)/g, (_, c) => c.toUpperCase());
                        this.elements[camelCaseId] = document.getElementById(id);
                    });
                }

                initEditor() {
                    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.48.0/min/vs' }});
                    require(['vs/editor/editor.main'], () => {
                        monaco.editor.defineTheme('gemini-dark-pro', {
                            base: 'vs-dark',
                            inherit: true,
                            rules: [],
                            colors: { 
                                'editor.background': '#1E1E1E',
                                'editor.lineHighlightBackground': '#2a2a2e'
                            }
                        });

                        // Register hover provider for tooltips
                        monaco.languages.registerHoverProvider('java', {
                            provideHover: (model, position) => {
                                const word = model.getWordAtPosition(position);
                                if (!word) return;
                                const keyword = word.word;
                                const explanations = {
                                    'public': 'An access modifier. `public` members are visible to all other classes.',
                                    'class': 'A blueprint for creating objects. It contains fields (variables) and methods (functions).',
                                    'static': 'A keyword that means the member belongs to the class itself, not to an instance of the class.',
                                    'void': 'A return type that indicates a method does not return any value.',
                                    'main': 'The entry point of a Java application. The code inside the `main` method is executed when the program starts.',
                                    'String': 'A data type that represents a sequence of characters (text).',
                                    'int': 'A primitive data type for storing whole numbers (integers).',
                                    'double': 'A primitive data type for storing floating-point (decimal) numbers.',
                                    'boolean': 'A primitive data type that can only have two values: `true` or `false`.',
                                    'char': 'A primitive data type for storing a single character.',
                                    'if': 'A conditional statement that executes a block of code if a specified condition is true.',
                                    'else': 'Used with `if` to execute a block of code when the condition is false.',
                                    'for': 'A control flow statement for creating a loop that executes a block of code a specific number of times.',
                                    'while': 'Creates a loop that executes a block of code as long as a condition remains true.',
                                    'switch': 'A control flow statement that allows a variable to be tested for equality against a list of values.',
                                    'case': 'A keyword used inside a `switch` statement to define a block of code to be executed.',
                                    'break': 'A keyword used to exit a `switch` statement or a loop.',
                                    'default': 'A keyword for a `switch` statement that specifies the code to run if there is no case match.',
                                    'new': 'An operator used to create new objects.',
                                    'return': 'A keyword to exit a method, with or without a value.',
                                    'import': 'A statement to import classes or entire packages into the current file.',
                                    'Scanner': 'A class in `java.util` used for obtaining the input of the primitive types like int, double, etc. and strings.'
                                };

                                if (explanations[keyword]) {
                                    return {
                                        range: new monaco.Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn),
                                        contents: [
                                            { value: `**\`${keyword}\`**` },
                                            { value: explanations[keyword] }
                                        ]
                                    };
                                }
                            }
                        });

                        this.editor = monaco.editor.create(this.elements.editor, {
                            language: 'java',
                            theme: 'gemini-dark-pro',
                            automaticLayout: true,
                            fontSize: 14, 
                            wordWrap: 'on',
                            folding: true,
                            padding: { top: 18, bottom: 18 },
                            scrollBeyondLastLine: false,
                            renderLineHighlight: 'all',
                            smoothScrolling: true,
                            cursorBlinking: 'smooth',
                            minimap: { enabled: true }
                        });

                        this.editor.onDidChangeModelContent(() => {
                            if (!this.lessons || this.lessons.length === 0) return;
                            const lessonId = this.lessons[this.currentLessonIndex].id;
                            this.userCode[lessonId] = this.editor.getValue();
                            this.saveState(false);
                        });

                        this.editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {
                            this.elements.runBtn.click();
                        });

                        this.elements.editorPlaceholder.style.display = 'none';
                        this.elements.editor.style.opacity = '1';
                    });
                }

                addEventListeners() {
                    this.elements.runBtn.addEventListener('click', () => this.runCodeCheck());
                    this.elements.solveBtn.addEventListener('click', () => this.solveLesson());
                    this.elements.resetBtn.addEventListener('click', () => {
                        this.showConfirmation(
                            'Reset Code?',
                            'This will discard your current code for this lesson and restore the original template. This cannot be undone.',
                            () => this.resetCode()
                        );
                    });
                     this.elements.resetProgressBtn.addEventListener('click', () => {
                        this.showConfirmation(
                            'Reset All Progress?',
                            'This will permanently delete all your saved code and completion history from your browser\'s local storage. Are you absolutely sure?',
                            () => this.storageService.resetProgress(),
                            'btn-danger'
                        );
                    });
                    this.elements.prevLessonBtn.addEventListener('click', () => this.loadLesson(this.currentLessonIndex - 1));
                    this.elements.nextLessonBtn.addEventListener('click', () => this.loadLesson(this.currentLessonIndex + 1));
                    this.elements.aiAskBtn.addEventListener('click', () => this.handleAIChat());
                    this.elements.aiInput.addEventListener('keypress', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); this.handleAIChat(); } });
                    this.elements.aiInput.addEventListener('input', e => {
                        e.target.style.height = 'auto';
                        e.target.style.height = (e.target.scrollHeight) + 'px';
                    });
                    this.elements.viewTutorialBtn.addEventListener('click', () => this.openTutorial());
                    this.elements.closeTutorialBtn.addEventListener('click', () => this.closeModal('tutorial'));
                    this.elements.tutorialModalBg.addEventListener('click', () => this.closeModal('tutorial'));
                    
                    this.elements.confirmModalCancelBtn.addEventListener('click', () => this.closeModal('confirm'));
                    this.elements.confirmModalBg.addEventListener('click', () => this.closeModal('confirm'));

                    this.elements.searchBtn.addEventListener('click', () => this.editor.getAction('actions.find').run());
                    this.elements.formatBtn.addEventListener('click', () => this.editor.getAction('editor.action.formatDocument').run());
                    this.elements.clearConsoleBtn.addEventListener('click', () => this.clearConsole(true));
                    this.elements.sidebarToggleBtn.addEventListener('click', () => this.toggleSidebar());
                    if (this.elements.aiModelRefreshBtn) {
                        this.elements.aiModelRefreshBtn.addEventListener('click', () => this.initOllamaModels(true));
                    }
                }

                initProviderSelect() {
                    const select = this.elements.aiProvider;
                    if (!select) return;
                    const providers = [
                        { value: 'ollama', label: 'Ollama' },
                        { value: 'lmstudio', label: 'LM Studio' },
                    ];
                    select.innerHTML = '';
                    providers.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p.value;
                        opt.textContent = p.label;
                        select.appendChild(opt);
                    });
                    const savedProvider = localStorage.getItem('aiProvider') || 'ollama';
                    select.value = providers.some(p => p.value === savedProvider) ? savedProvider : 'ollama';
                    select.addEventListener('change', () => {
                        localStorage.setItem('aiProvider', select.value);
                        this.initOllamaModels(true);
                    });
                }

                addResizerLogic() {
                    const resizer = this.elements.resizer;
                    const leftPanel = this.elements.leftPanel;
                    const rightPanel = this.elements.rightPanel;

                    const mouseMoveHandler = (e) => {
                        const sidebarWidth = this.elements.lessonSidebar.offsetWidth;
                        const totalWidth = leftPanel.parentElement.offsetWidth;
                        let newLeftWidth = ((e.clientX - sidebarWidth) / totalWidth) * 100;
                        
                        // Enforce min/max width constraints
                        newLeftWidth = Math.max(20, Math.min(80, newLeftWidth));

                        leftPanel.style.width = `${newLeftWidth}%`;
                        rightPanel.style.width = `${100 - newLeftWidth}%`;
                    };

                    const mouseUpHandler = () => {
                        resizer.classList.remove('resizing');
                        window.removeEventListener('mousemove', mouseMoveHandler);
                        window.removeEventListener('mouseup', mouseUpHandler);
                    };

                    resizer.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        resizer.classList.add('resizing');
                        window.addEventListener('mousemove', mouseMoveHandler);
                        window.addEventListener('mouseup', mouseUpHandler);
                    });
                }

                resetUI() {
                    this.clearConsole(true);
                    const welcomeMessage = [
                        "I'm your AI assistant. Stuck? Try the tutorial first, then ask me for a hint!",
                        "\n\n",
                        "Tip: For blazing-fast local responses, try ",
                        "**NVIDIA-Nemotron-Nano-12B-v2-GGUF**.",
                        " If Ollama doesn’t have it, you can load it via ",
                        "[LM Studio](https://lmstudio.ai)."
                    ].join("");
                    const html = this.renderMarkdown(welcomeMessage);
                    this.elements.aiChat.innerHTML = `<div class="chat-bubble markdown-body p-3 rounded-lg bg-gemini-bg-tertiary self-start mr-auto">${html}</div>`;
                    this.populateLessonSidebar();
                }

                async initOllamaModels(showToastOnError = false) {
                    const modelSelect = this.elements.aiModel;
                    if (!modelSelect) return;
                    const provider = (this.elements.aiProvider && this.elements.aiProvider.value) || localStorage.getItem('aiProvider') || 'ollama';
                    const endpoint = provider === 'lmstudio' ? '/lmstudio/models' : '/ollama/models';
                    const storageKey = provider === 'lmstudio' ? 'lmstudioModel' : 'ollamaModel';
                    try {
                        modelSelect.innerHTML = '';
                        const resp = await fetch(endpoint);
                        if (!resp.ok) throw new Error(`Failed to fetch models: ${resp.status}`);
                        const data = await resp.json();
                        const models = data.models || [];
                        if (models.length === 0) {
                            const opt = document.createElement('option');
                            opt.value = '';
                            opt.textContent = 'No models found';
                            modelSelect.appendChild(opt);
                            if (showToastOnError) {
                                if (provider === 'lmstudio') {
                                    this.showToast('No LM Studio models found. Start LM Studio server (http://127.0.0.1:1234) and load a model.', 'error');
                                } else {
                                    this.showToast('No Ollama models found. Start Ollama and pull a model (e.g., "ollama pull llama3.1").', 'error');
                                }
                            }
                            return;
                        }
                        const saved = localStorage.getItem(storageKey);
                        models.forEach(m => {
                            const opt = document.createElement('option');
                            opt.value = m.name;
                            opt.textContent = m.name;
                            modelSelect.appendChild(opt);
                        });
                        if (saved && models.some(m => m.name === saved)) {
                            modelSelect.value = saved;
                        } else {
                            modelSelect.value = models[0].name;
                            localStorage.setItem(storageKey, modelSelect.value);
                        }
                        modelSelect.addEventListener('change', () => {
                            localStorage.setItem(storageKey, modelSelect.value);
                        }, { once: true });
                    } catch (err) {
                        const opt = document.createElement('option');
                        opt.value = '';
                        opt.textContent = 'Models unavailable';
                        modelSelect.appendChild(opt);
                        if (showToastOnError) {
                            if (provider === 'lmstudio') {
                                this.showToast('Unable to reach LM Studio. Is it running on http://127.0.0.1:1234?', 'error');
                            } else {
                                this.showToast('Unable to reach Ollama. Is it running on port 11434?', 'error');
                            }
                        }
                    }
                }

                loadLesson(index, options = {}) {
                    if (index < 0 || index >= this.lessons.length || !this.isDbReady) return;
                    
                    const lessonPanel = document.getElementById('lesson-panel');
                    lessonPanel.classList.remove('fade-in');
                    lessonPanel.style.opacity = '0';
                    
                    this.currentLessonIndex = index;
                    this.saveState(true); 
                    const lesson = this.lessons[this.currentLessonIndex];
                    const isCompleted = this.lessonCompletion[lesson.id];

                    this.elements.nextLessonBtn.classList.remove('animate-pulse', 'bg-emerald-500');
                    this.elements.nextLessonBtn.querySelector('span').textContent = 'Next';

                    setTimeout(() => {
                        this.elements.lessonTitle.innerHTML = `${lesson.title} ${isCompleted ? '<i class="fa-solid fa-circle-check text-emerald-400 ml-3 text-xl"></i>' : ''}`;
                        this.elements.lessonDescription.textContent = lesson.description;
                        
                        this.updateLessonStatus(lesson.id);
                        this.populateLessonSidebar();

                        if (this.editor) {
                            const savedCode = this.userCode[lesson.id];
                            this.editor.setValue(savedCode || lesson.initialCode);
                            this.editor.focus();
                        }
                        if (!options.isReload) {
                            this.logToConsole(`Lesson "${lesson.title}" loaded.`);
                        }
                        this.elements.prevLessonBtn.disabled = this.currentLessonIndex === 0;
                        this.elements.nextLessonBtn.disabled = this.currentLessonIndex === this.lessons.length - 1;
                        
                        this.updateProgress();

                        this.elements.viewTutorialBtn.style.display = lesson.tutorial ? 'flex' : 'none';
                        
                        lessonPanel.style.opacity = '1';
                        lessonPanel.classList.add('fade-in');
                    }, 200);
                }

                resetCode() {
                    const lesson = this.lessons[this.currentLessonIndex];
                    this.editor.setValue(lesson.initialCode);
                    this.logToConsole('Code has been reset to the initial state.', 'info');
                }
                
                solveLesson() {
                    const lesson = this.lessons[this.currentLessonIndex];
                    if (lesson.fullSolution) {
                        this.editor.setValue(lesson.fullSolution);
                        this.logToConsole('Lesson solution loaded into the editor.', 'info');
                    } else {
                        this.showToast("No solution available for this lesson.", "error");
                    }
                }

                // =================================================================
                // === REAL CODE EXECUTION VIA BACKEND SERVER ======================
                // =================================================================
                async runCodeCheck() {
                    if (!this.editor) return;

                    const userCode = this.editor.getValue();
                    const currentLesson = this.lessons[this.currentLessonIndex];

                    this.clearConsole();
                    this.logToConsole('Executing code on server...', 'info');

                    try {
                        // Prepare payload with code and optional user input
                        const payload = { code: userCode };
                        // Use the currentLesson reference to include simulated input
                        if (currentLesson && currentLesson.userInput && currentLesson.userInput.length > 0) {
                            payload.input = currentLesson.userInput.join('\n');
                        }
                        
                        // Send code to the backend server
                        const response = await fetch('/run/java', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();
                        const actualOutput = result.output || "";
                        
                        this.logToConsole('Execution finished.', 'info');

                        if (result.error) {
                            const errorType = result.type === 'compilation' ? 'Compilation Error' : 'Runtime Error';
                            this.logToConsole(`❌ ${errorType}:`, 'error');
                            // Clean up the error message for better readability
                            const cleanedError = actualOutput.replace(/Main.java:\d+:/g, 'Line: ');
                            this.logToConsole(cleanedError, 'error');
                            this.updateLessonStatus(currentLesson.id);
                            return;
                        }
                        
                        // Log the actual output from the server
                        this.logToConsole(actualOutput, 'user-output');

                        // --- Compare server output with expected output ---
                        const normalize = (str) => (str || '').trim().replace(/\r\n/g, '\n');
                        let expectedOutput = currentLesson.expectedOutput;
                        let isCorrect = false;

                        // Special check for Lesson 9 (dynamic output)
                        if (currentLesson.id === 9) { 
                            const methodCallMatch = userCode.match(/greetUser\s*\(\s*"([^"]+)"\s*\)/);
                            if (methodCallMatch && methodCallMatch[1]) {
                                expectedOutput = `Hello, ${methodCallMatch[1]}!`;
                                if (normalize(actualOutput) === normalize(expectedOutput)) {
                                    isCorrect = true;
                                }
                            } else {
                                this.logToConsole(`❌ Not quite right. Could not find a valid call to the greetUser method with a name in double quotes, like greetUser("Alex");`, 'error');
                                return;
                            }
                        // Special check for Lesson 44 (HashMap order is not guaranteed)
                        } else if (currentLesson.id === 44) { 
                            const expectedLines = normalize(expectedOutput).split('\n').sort();
                            const actualLines = normalize(actualOutput).split('\n').sort();
                            if (JSON.stringify(expectedLines) === JSON.stringify(actualLines)) {
                                isCorrect = true;
                            }
                        } else {
                            // Standard check for all other lessons
                            if (normalize(actualOutput) === normalize(expectedOutput)) {
                                isCorrect = true;
                            }
                        }

                        if (isCorrect) {
                            this.logToConsole(`✔ Success! You completed "${currentLesson.title}".`, 'success');
                            this.triggerConfetti();
                            this.lessonCompletion[currentLesson.id] = true;
                            this.saveState(true);
                            this.loadLesson(this.currentLessonIndex, { isReload: true });
                            this.populateLessonSidebar();

                            if (this.currentLessonIndex < this.lessons.length - 1) {
                                this.elements.nextLessonBtn.classList.add('animate-pulse', 'bg-emerald-500');
                                this.elements.nextLessonBtn.querySelector('span').textContent = 'Continue';
                            }
                        } else {
                            this.logToConsole(`❌ Not quite right. The code runs, but the output doesn't match.`, 'error');
                            if (expectedOutput) {
                                this.logToConsole('Expected output:', 'info');
                                this.logToConsole(expectedOutput, 'system-output');
                            }
                            this.logToConsole('Your output:', 'info');
                            this.logToConsole(actualOutput || '(No output)', 'user-output');
                            this.updateLessonStatus(currentLesson.id);
                        }

                    } catch (error) {
                        console.error('Network or server error:', error);
                        this.logToConsole('❌ Error connecting to the execution server. Is it running?', 'error');
                        this.logToConsole(error.message, 'error');
                    }
                }
                
                // =================================================================
                // === UI AND STATE MANAGEMENT METHODS (Unchanged) =================
                // =================================================================
                
                updateLessonStatus(lessonId) {
                    if (this.lessonCompletion[lessonId]) {
                        this.elements.lessonStatus.innerHTML = '<i class="fa-solid fa-check-circle text-emerald-400 mr-2"></i>Completed!';
                    } else {
                        this.elements.lessonStatus.innerHTML = '';
                    }
                }
                
                updateProgress() {
                    const completedCount = Object.values(this.lessonCompletion).filter(Boolean).length;
                    const progress = (completedCount / this.lessons.length) * 100;
                    this.elements.progressBar.style.width = `${progress}%`;
                    this.elements.progressLabel.textContent = `Progress: ${completedCount}/${this.lessons.length}`;
                }

                toggleSidebar() {
                    this.elements.lessonSidebar.classList.toggle('hidden');
                }

                populateLessonSidebar() {
                    const list = this.elements.lessonList;
                    list.innerHTML = '';
                    this.lessons.forEach((lesson, index) => {
                        const isCompleted = this.lessonCompletion[lesson.id];
                        const isActive = index === this.currentLessonIndex;
                        const item = document.createElement('a');
                        item.href = '#';
                        item.className = `sidebar-lesson-item flex items-center justify-between p-3 rounded-md text-sm transition-colors hover:bg-gemini-bg-tertiary ${isActive ? 'active' : ''}`;
                        item.innerHTML = `
                            <span class="truncate">${lesson.title}</span>
                            ${isCompleted ? '<i class="fa-solid fa-circle-check text-emerald-400 ml-2 flex-shrink-0"></i>' : ''}
                        `;
                        item.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.loadLesson(index);
                        });
                        list.appendChild(item);
                    });
                }
                
                showConfirmation(title, text, onConfirm, confirmClass = 'btn-danger') {
                    this.elements.confirmModalTitle.textContent = title;
                    this.elements.confirmModalText.textContent = text;
                    
                    const confirmBtn = this.elements.confirmModalConfirmBtn;
                    confirmBtn.className = `btn ${confirmClass}`;
                    
                    confirmBtn.onclick = () => {
                        onConfirm();
                        this.closeModal('confirm');
                    };
                    this.openModal('confirm');
                }

                openModal(type) {
                    const modal = this.elements[`${type}Modal`];
                    const bg = this.elements[`${type}ModalBg`];
                    const content = this.elements[`${type}ModalContent`];

                    modal.classList.remove('hidden');
                    requestAnimationFrame(() => {
                        bg.classList.remove('opacity-0');
                        content.classList.remove('opacity-0', 'scale-95');
                    });
                }

                closeModal(type) {
                    const modal = this.elements[`${type}Modal`];
                    const bg = this.elements[`${type}ModalBg`];
                    const content = this.elements[`${type}ModalContent`];

                    bg.classList.add('opacity-0');
                    content.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => { modal.classList.add('hidden'); }, 300);
                }

                openTutorial() {
                    const lesson = this.lessons[this.currentLessonIndex];
                    if (!lesson.tutorial) return;

                    this.elements.tutorialTitle.innerHTML = `<i class="fa-solid fa-book-open text-sky-400 mr-3"></i> Tutorial: ${lesson.title}`;
                    this.elements.tutorialBody.innerHTML = lesson.tutorial;
                    
                    this.elements.tutorialBody.querySelectorAll('.code-block-wrapper').forEach(wrapper => {
                        const pre = wrapper.querySelector('pre');
                        if (!pre) return;
                        const code = pre.textContent.trim();
                        const lineCount = code.split('\n').length;
                        
                        const editorDiv = document.createElement('div');
                        editorDiv.style.height = `${Math.max(lineCount * 21, 50)}px`;
                        wrapper.appendChild(editorDiv);
                        
                        monaco.editor.create(editorDiv, {
                            value: code, language: 'java', theme: 'gemini-dark-pro',
                            readOnly: true, domReadOnly: true, automaticLayout: true,
                            minimap: { enabled: false }, lineNumbers: 'off', folding: false,
                            scrollBeyondLastLine: false, contextmenu: false, wordWrap: 'on',
                            padding: { top: 10, bottom: 10 }
                        });
                        this.addCopyToCodeBlock(wrapper, code);
                        pre.remove();
                    });

                    this.openModal('tutorial');
                }
                
                saveState(silent = false) {
                    if (!this.isDbReady || !this.firebaseService) return;
                    const state = {
                        currentLessonIndex: this.currentLessonIndex,
                        userCode: this.userCode,
                        lessonCompletion: this.lessonCompletion
                    };
                    
                    this.debouncedSave(state, silent);
                }
                
                debouncedSave(state, silent) {
                    clearTimeout(this.saveTimeout);
                    this.saveTimeout = setTimeout(() => {
                        this.storageService.saveData(state);
                        if (!silent) {
                            this.showToast('Progress saved!', 'info');
                        }
                    }, 1500);
                }

                loadStateFromDb(state) {
                    if (state) {
                        this.currentLessonIndex = state.currentLessonIndex || 0;
                        this.userCode = state.userCode || {};
                        this.lessonCompletion = state.lessonCompletion || {};
                    } else {
                        this.currentLessonIndex = 0;
                        this.userCode = {};
                        this.lessonCompletion = {};
                    }
                    this.loadLesson(this.currentLessonIndex, {isReload: true});
                    this.populateLessonSidebar();
                }

                async handleAIChat() {
                    const userPrompt = this.elements.aiInput.value;
                    if (!userPrompt.trim()) return;
                    this.addMessageToChat('user', userPrompt);
                    this.elements.aiInput.value = '';
                    this.elements.aiInput.style.height = 'auto';
                    this.setAIStatus('thinking');
                    this.showAITypingIndicator();

                    try {
                        const lessonContext = this.lessons[this.currentLessonIndex];

                        // Build a focused system prompt with richer lesson context
                        const expected = (lessonContext && lessonContext.expectedOutput) ? `\nExpected Output (exact match):\n\n\`\`\`\n${lessonContext.expectedOutput}\n\`\`\`\n` : '';
                        const systemPrompt = [
                            "You are an expert and encouraging Java tutor for the 'devbootLLM' learning app.",
                            "Guide the student with hints and reasoning, not final solutions.",
                            "Always answer in concise Markdown with helpful headings and bullet points.",
                            "Use fenced code blocks with language tags, e.g., ```java ...```.",
                            "",
                            `Lesson: ${lessonContext.id}. ${lessonContext.title}`,
                            `Description: ${lessonContext.description}`,
                            expected,
                            "Constraints: Java runs with -Xmx64m and a 10s timeout; prefer simple, efficient examples.",
                            "Policy: Do NOT paste the full final solution. Point the student to the next step instead."
                        ].filter(Boolean).join('\n');

                        // User message: their question + current code
                        const userMsg = [
                            `Question: ${userPrompt}`,
                            "",
                            "Student's current code:",
                            "",
                            "```java",
                            this.editor.getValue(),
                            "```"
                        ].join('\n');

                        // Keep short conversational memory
                        if (this.chatHistory.length > 8) {
                            this.chatHistory = this.chatHistory.slice(-8);
                        }
                        // Persist only the user message + later the model reply
                        this.chatHistory.push({ role: "user", parts: [{ text: userMsg }] });

                        // For the provider call, prepend a system message to give richer context
                        const requestHistory = [
                            { role: 'system', parts: [{ text: systemPrompt }] },
                            ...this.chatHistory
                        ];

                        const provider = (this.elements.aiProvider && this.elements.aiProvider.value) || localStorage.getItem('aiProvider') || 'ollama';
                        const model = (this.elements.aiModel && this.elements.aiModel.value) ? this.elements.aiModel.value : '';

                        if (provider === 'lmstudio') {
                            // Streaming path for LM Studio
                            const resp = await fetch('/lmstudio/chat/stream', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ model, history: requestHistory })
                            });
                            if (!resp.ok || !resp.body) throw new Error(`lmstudio API Error: ${resp.status} ${resp.statusText}`);
                            // Prepare streaming bubble
                            this.hideAITypingIndicator();
                            this.addMessageToChat('ai', '');
                            const bubble = this.elements.aiChat.lastElementChild;
                            const reader = resp.body.getReader();
                            const decoder = new TextDecoder();
                            let acc = '';
                            const formatMsg = (txt) => this.renderMarkdown(txt);
                            const pump = async () => {
                                while (true) {
                                    const { value, done } = await reader.read();
                                    if (done) break;
                                    const chunk = decoder.decode(value, { stream: true });
                                    acc += chunk;
                                    bubble.innerHTML = formatMsg(acc);
                                    this.postProcessMarkdownBubble(bubble);
                                    this.elements.aiChat.scrollTop = this.elements.aiChat.scrollHeight;
                                }
                            };
                            await pump();
                            const aiResponseText = acc || "";
                            this.chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });
                        } else {
                            // Streaming path for Ollama
                            const resp = await fetch('/ollama/chat/stream', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ model, history: requestHistory })
                            });
                            if (!resp.ok || !resp.body) throw new Error(`ollama API Error: ${resp.status} ${resp.statusText}`);
                            this.hideAITypingIndicator();
                            this.addMessageToChat('ai', '');
                            const bubble = this.elements.aiChat.lastElementChild;
                            const reader = resp.body.getReader();
                            const decoder = new TextDecoder();
                            let acc = '';
                            const formatMsg = (txt) => this.renderMarkdown(txt);
                            const pump = async () => {
                                while (true) {
                                    const { value, done } = await reader.read();
                                    if (done) break;
                                    const chunk = decoder.decode(value, { stream: true });
                                    acc += chunk;
                                    bubble.innerHTML = formatMsg(acc);
                                    this.postProcessMarkdownBubble(bubble);
                                    this.elements.aiChat.scrollTop = this.elements.aiChat.scrollHeight;
                                }
                            };
                            await pump();
                            const aiResponseText = acc || "";
                            this.chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });
                        }
                    } catch (error) {
                        console.error("Error calling AI provider:", error);
                        this.hideAITypingIndicator();
                        const provider = (this.elements.aiProvider && this.elements.aiProvider.value) || localStorage.getItem('aiProvider') || 'ollama';
                        if (provider === 'lmstudio') {
                            this.addMessageToChat('ai', 'There was an error connecting to LM Studio. Ensure LM Studio server is running at http://127.0.0.1:1234 and a model is loaded.');
                        } else {
                            this.addMessageToChat('ai', 'There was an error connecting to the local AI (Ollama). Ensure Ollama is running and a model is available.');
                        }
                    } finally {
                        this.setAIStatus('idle');
                    }
                }

                setAIStatus(status) {
                    const { aiAskBtn, aiInput, aiAskIcon } = this.elements;
                    if (status === 'thinking') {
                        aiAskBtn.disabled = true;
                        aiInput.disabled = true;
                        aiAskIcon.className = 'fa-solid fa-spinner fa-spin';
                    } else {
                        aiAskBtn.disabled = false;
                        aiInput.disabled = false;
                        aiAskIcon.className = 'fa-solid fa-paper-plane';
                        aiInput.focus();
                    }
                }
                
                showAITypingIndicator() {
                    const indicator = document.createElement('div');
                    indicator.id = 'typing-indicator';
                    indicator.className = 'chat-bubble p-3 rounded-lg bg-gemini-bg-tertiary self-start';
                    indicator.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
                    this.elements.aiChat.appendChild(indicator);
                    this.elements.aiChat.scrollTop = this.elements.aiChat.scrollHeight;
                }

                hideAITypingIndicator() {
                    const indicator = document.getElementById('typing-indicator');
                    if (indicator) {
                        indicator.remove();
                    }
                }

                addMessageToChat(sender, message) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'chat-bubble markdown-body p-3 rounded-lg text-sm flex flex-col max-w-[90%] w-fit';
                    
                    const html = this.renderMarkdown(message || '');

                    if (sender === 'user') {
                        wrapper.classList.add('bg-[#3c4043]', 'self-end', 'items-end');
                    } else {
                        wrapper.classList.add('bg-gemini-bg-tertiary', 'self-start', 'items-start');
                    }
                    wrapper.innerHTML = html;
                    this.postProcessMarkdownBubble(wrapper);
                    

                    this.elements.aiChat.appendChild(wrapper);
                    this.elements.aiChat.scrollTop = this.elements.aiChat.scrollHeight;
                }

                renderMarkdown(text) {
                    try {
                        if (!this._markedConfigured) {
                            marked.setOptions({ gfm: true, breaks: true, headerIds: false });
                            this._markedConfigured = true;
                        }
                        const rawHtml = marked.parse(text || '');
                        const clean = DOMPurify.sanitize(rawHtml, { USE_PROFILES: { html: true } });
                        return clean;
                    } catch (_) {
                        const escape = (s) => String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        return `<p>${escape(text || '')}</p>`;
                    }
                }

                postProcessMarkdownBubble(bubbleEl) {
                    bubbleEl.querySelectorAll('pre').forEach(pre => {
                        const code = pre.querySelector('code');
                        if (code) {
                            try { hljs.highlightElement(code); } catch (_) {}
                        }
                        if (!pre.parentElement.classList.contains('code-block-wrapper')) {
                            const wrap = document.createElement('div');
                            wrap.className = 'code-block-wrapper';
                            pre.parentElement.insertBefore(wrap, pre);
                            wrap.appendChild(pre);
                            this.addCopyToCodeBlock(wrap, pre.textContent || '');
                        }
                    });
                }

                addCopyToCodeBlock(wrapper, code) {
                    const btn = document.createElement('button');
                    btn.innerHTML = '<i class="fa-solid fa-copy"></i> Copy';
                    btn.className = 'code-block-copy-btn';
                    btn.onclick = () => {
                        const textarea = document.createElement('textarea');
                        textarea.value = code;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        this.showToast('Code copied to clipboard!');
                    };
                    wrapper.appendChild(btn);
                }

                clearConsole(isManual = false) {
                    this.elements.consoleOutput.innerHTML = '';
                    if (isManual) {
                        this.logToConsole('Console cleared.', 'info');
                    }
                }

                logToConsole(message, type = 'info', addNewLine = true) {
                    const { consoleOutput } = this.elements;
                    const MAX_LOGS = 100;
                    
                    while (consoleOutput.children.length >= MAX_LOGS) {
                        consoleOutput.removeChild(consoleOutput.firstChild);
                    }

                    let line;
                    let lastLine = consoleOutput.lastChild;
                    let isContinuingLine = !addNewLine && lastLine && lastLine.dataset.type === type;

                    if (isContinuingLine) {
                        line = lastLine;
                    } else {
                        line = document.createElement('div');
                        line.className = 'flex flex-row';
                        line.dataset.type = type;
                        
                        if (type === 'user-output' || type === 'system-output') {
                            const prompt = document.createElement('span');
                            prompt.className = 'text-gray-500 mr-2 select-none';
                            prompt.textContent = '>';
                            line.appendChild(prompt);
                        } else {
                            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                            const timeEl = document.createElement('span');
                            timeEl.className = 'text-gray-500 mr-2 flex-shrink-0 select-none';
                            timeEl.textContent = timestamp;
                            line.appendChild(timeEl);
                        }
                        consoleOutput.appendChild(line);
                    }

                    const msgSpan = document.createElement('span');
                    if (String(message).includes('\n')) {
                        msgSpan.innerHTML = `<pre class="whitespace-pre-wrap">${message}</pre>`;
                    } else {
                        msgSpan.textContent = message;
                    }

                    let typeClass = 'text-gray-300';
                    switch(type) {
                        case 'success': typeClass = 'text-emerald-400'; break;
                        case 'error': typeClass = 'text-rose-400'; break;
                        case 'user-output': typeClass = 'text-cyan-300'; break;
                        case 'system-output': typeClass = 'text-sky-400'; break;
                    }
                    msgSpan.className = typeClass;
                    
                    if (isContinuingLine) {
                        const lastMsgSpan = line.querySelector('span:last-child');
                        if (lastMsgSpan) {
                            lastMsgSpan.innerHTML += message;
                        }
                    } else {
                        line.appendChild(msgSpan);
                    }

                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                }
                
                showToast(message, type = 'success') {
                    const toast = document.createElement('div');
                    let iconHtml = '';
                    let colors = '';

                    if (type === 'success') {
                        iconHtml = '<i class="fa-solid fa-check-circle mr-2"></i>';
                        colors = 'bg-emerald-500 text-white';
                    } else if (type === 'info') {
                        iconHtml = '<i class="fa-solid fa-info-circle mr-2"></i>';
                        colors = 'bg-sky-500 text-white';
                    } else if (type === 'error') {
                        iconHtml = '<i class="fa-solid fa-times-circle mr-2"></i>';
                        colors = 'bg-rose-500 text-white';
                    }

                    toast.className = `flex items-center p-3 rounded-lg shadow-lg text-sm font-semibold ${colors} toast-in`;
                    toast.innerHTML = `${iconHtml}<span>${message}</span>`;
                    
                    this.elements.toastContainer.appendChild(toast);

                    setTimeout(() => {
                        toast.classList.remove('toast-in');
                        toast.classList.add('toast-out');
                        toast.addEventListener('animationend', () => toast.remove());
                    }, 3000);
                }

                setDbStatus(status, text) {
                    const { dbStatusLight, dbStatusText } = this.elements;
                    dbStatusLight.classList.remove('bg-yellow-500', 'bg-emerald-500', 'bg-rose-500', 'bg-sky-500', 'animate-pulse');
                    
                    switch(status) {
                        case 'connecting':
                            dbStatusLight.classList.add('bg-yellow-500', 'animate-pulse');
                            break;
                        case 'syncing':
                            dbStatusLight.classList.add('bg-sky-500', 'animate-pulse');
                            break;
                        case 'connected':
                            dbStatusLight.classList.add('bg-emerald-500');
                            break;
                        case 'error':
                             dbStatusLight.classList.add('bg-rose-500');
                            break;
                    }
                    dbStatusText.textContent = text;
                }

                triggerConfetti() {
                    const canvas = this.elements.confettiCanvas;
                    const ctx = canvas.getContext('2d');
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    const particleCount = 150;
                    const colors = ["#8b5cf6", "#a78bfa", "#ddd6fe", "#f59e0b", "#34d399"];

                    if (this.confettiParticles.length > 0) return;

                    for (let i = 0; i < particleCount; i++) {
                        this.confettiParticles.push(this.createParticle(canvas.width, canvas.height, colors));
                    }

                    const animate = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        this.confettiParticles.forEach((p, i) => {
                            p.x += p.vx;
                            p.y += p.vy;
                            p.opacity -= 0.01;
                            
                            if (p.opacity <= 0) {
                                this.confettiParticles.splice(i, 1);
                            } else {
                                ctx.globalAlpha = p.opacity;
                                ctx.fillStyle = p.color;
                                ctx.beginPath();
                                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                                ctx.fill();
                            }
                        });

                        if (this.confettiParticles.length > 0) {
                            requestAnimationFrame(animate);
                        } else {
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                        }
                    }
                    animate();
                }

                createParticle(w, h, colors) {
                    return {
                        x: Math.random() * w,
                        y: -20,
                        vx: Math.random() * 4 - 2,
                        vy: Math.random() * 3 + 2,
                        size: Math.random() * 6 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        opacity: 1
                    };
                }
            }

            // --- View Navigation and App Initialization ---
            const landingPageView = document.getElementById('landing-page-view');
            const learningPageView = document.getElementById('learning-page-view');
            const startJavaCourseBtn = document.getElementById('start-java-course-btn');
            const startJourneyBtn = document.getElementById('start-journey-btn');
            const homeLink = document.getElementById('home-link');
            let learningApp = null;

            function showLearningPage() {
                landingPageView.classList.add('fade-out');
                setTimeout(() => {
                    landingPageView.classList.add('hidden');
                    landingPageView.classList.remove('fade-out');
                    learningPageView.classList.remove('hidden');
                    learningPageView.classList.add('fade-in');
                    if (!learningApp) {
                        learningApp = new LearningAppController();
                        learningApp.init();
                    }
                }, 300);
            }

            function showLandingPage() {
                learningPageView.classList.add('fade-out');
                 setTimeout(() => {
                    learningPageView.classList.add('hidden');
                    learningPageView.classList.remove('fade-out');
                    landingPageView.classList.remove('hidden');
                    landingPageView.classList.add('fade-in');
                }, 300);
            }

            startJavaCourseBtn.addEventListener('click', showLearningPage);
            homeLink.addEventListener('click', showLandingPage);
            startJourneyBtn.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('courses').scrollIntoView({ behavior: 'smooth' });
            });

        });
    </script>
</body>
</html>
